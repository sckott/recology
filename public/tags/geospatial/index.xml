<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Geospatial on Recology</title>
    <link>http://localhost:1313/tags/geospatial/</link>
    <description>Recent content in Geospatial on Recology</description>
    <generator>Hugo -- 0.143.1</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 09 Jun 2016 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/geospatial/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Marine Regions data in R</title>
      <link>http://localhost:1313/2016/06/marine-regions/</link>
      <pubDate>Thu, 09 Jun 2016 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2016/06/marine-regions/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;UPDATE: pkg API has changed - updated the post below to work with the current CRAN version, submitted 2016-08-02&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was at a hackathon focused on Ocean Biogeographic Information System (OBIS) data back in November last year in Belgium. One project idea was to make it easier to get at data based on one or more marine regions. I was told that Marineregions.org is often used for shape files to get different regions to then do other work with.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<blockquote>
<p>UPDATE: pkg API has changed - updated the post below to work with the current CRAN version, submitted 2016-08-02</p></blockquote>
<p>I was at a hackathon focused on Ocean Biogeographic Information System (OBIS) data back in November last year in Belgium. One project idea was to make it easier to get at data based on one or more marine regions. I was told that Marineregions.org is often used for shape files to get different regions to then do other work with.</p>
<p>During the event I started a package <a href="https://github.com/ropenscilabs/mregions">mregions</a>. Here I&rsquo;ll show how to get different marine regions, then use those outputs
to get species occurrence data.</p>
<p>We&rsquo;ll use WKT (Well-Known Text) to define spatial dimensions in this post. If
you don&rsquo;t know what it is, Wikipedia to the rescue: <a href="https://en.wikipedia.org/wiki/Well-known_text">https://en.wikipedia.org/wiki/Well-known_text</a></p>
<h2 id="install">Install</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;mregions&#34;</span>)
</span></span><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;iobis/robis&#34;</span>)
</span></span></code></pre></div><p>Or get the dev version</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;ropenscilabs/mregions&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;mregions&#34;</span>)
</span></span></code></pre></div><h2 id="get-list-of-place-types">Get list of place types</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_place_types</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">head</span>(res<span style="color:#f92672">$</span>type)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Town&#34;                      &#34;Arrondissement&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [3] &#34;Department&#34;                &#34;Province (administrative)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [5] &#34;Country&#34;                   &#34;Continent&#34;</span>
</span></span></code></pre></div><h2 id="get-marineregions-records-by-place-type">Get Marineregions records by place type</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_records_by_type</span>(type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;EEZ&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">head</span>(res)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   MRGID                                            gazetteerSource</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1  3293 Maritime Boundaries Geodatabase, Flanders Marine Institute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2  5668 Maritime Boundaries Geodatabase, Flanders Marine Institute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3  5669 Maritime Boundaries Geodatabase, Flanders Marine Institute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4  5670 Maritime Boundaries Geodatabase, Flanders Marine Institute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5  5672 Maritime Boundaries Geodatabase, Flanders Marine Institute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6  5673 Maritime Boundaries Geodatabase, Flanders Marine Institute</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   placeType latitude longitude minLatitude minLongitude maxLatitude</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1       EEZ 51.46483  2.704458    51.09111     2.238118    51.87000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2       EEZ 53.61508  4.190675    51.26203     2.539443    55.76500</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3       EEZ 54.55970  8.389231    53.24281     3.349999    55.91928</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4       EEZ 40.87030 19.147094    39.63863    18.461940    41.86124</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5       EEZ 42.94272 29.219062    41.97820    27.449580    43.74779</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6       EEZ 43.42847 15.650844    41.62201    13.001390    45.59079</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   maxLongitude precision            preferredGazetteerName</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1     3.364907  58302.49   Belgian Exclusive Economic Zone</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2     7.208364 294046.10     Dutch Exclusive Economic Zone</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3    14.750000 395845.50    German Exclusive Economic Zone</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4    20.010030 139751.70  Albanian Exclusive Economic Zone</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5    31.345280 186792.50 Bulgarian Exclusive Economic Zone</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6    18.552360 313990.30  Croatian Exclusive Economic Zone</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   preferredGazetteerNameLang   status accepted</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                    English standard     3293</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                    English standard     5668</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                    English standard     5669</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4                    English standard     5670</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5                    English standard     5672</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6                    English standard     5673</span>
</span></span></code></pre></div><h2 id="get-and-search-region-names">Get and search region names</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>(res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_names</span>())
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; # A tibble: 676 x 4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                              name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                             &lt;chr&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1           Morocco:elevation_10m</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2          Emodnet:emodnet1x1grid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                    Emodnet:grid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4                     Morocco:dam</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5             WoRMS:azmp_sections</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6    Morocco:accomodationcapacity</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7          Morocco:admin_boundary</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 8  Lifewatch:ovam_afvalverwerking</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 9          Eurobis:eurobis_points</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 10                  Morocco:roads</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; # ... with 666 more rows, and 3 more variables: title &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   name_first &lt;chr&gt;, name_second &lt;chr&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mr_names_search</span>(res, q <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;IHO&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; # A tibble: 5 x 4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                   name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                  &lt;chr&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                    MarineRegions:iho</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 MarineRegions:iho_quadrants_20150810</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                     World:iosregions</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4       MarineRegions:eez_iho_union_v2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5                   Belgium:vl_venivon</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; # ... with 3 more variables: title &lt;chr&gt;, name_first &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   name_second &lt;chr&gt;</span>
</span></span></code></pre></div><h2 id="get-a-region---geojson">Get a region - geojson</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_geojson</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Turkmen Exclusive Economic Zone&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">class</span>(res)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;mr_geojson&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">names</span>(res)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;type&#34;          &#34;totalFeatures&#34; &#34;features&#34;      &#34;crs&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [5] &#34;bbox&#34;</span>
</span></span></code></pre></div><h2 id="get-a-region---shp">Get a region - shp</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_shp</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Belgian Exclusive Economic Zone&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">class</span>(res)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;SpatialPolygonsDataFrame&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;package&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;sp&#34;</span>
</span></span></code></pre></div><h2 id="get-obis-eez-id">Get OBIS EEZ ID</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_names</span>()
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> res<span style="color:#a6e22e">[grepl</span>(<span style="color:#e6db74">&#34;eez&#34;</span>, res<span style="color:#f92672">$</span>name, ignore.case <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mr_obis_eez_id</span>(res<span style="color:#f92672">$</span>title[2])
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 84</span>
</span></span></code></pre></div><h2 id="convert-to-wkt">Convert to WKT</h2>
<p>From geojson or shp. Here, geojson</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_geojson</span>(key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MarineRegions:eez_33176&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mr_as_wkt</span>(res, fmt <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;MULTIPOLYGON (((41.573732 -1.659444, 45.891882 ... cutoff</span>
</span></span></code></pre></div><h2 id="get-regions-then-obis-data">Get regions, then OBIS data</h2>
<h3 id="using-well-known-text">Using Well-Known Text</h3>
<p>Both shp and geojson data returned from <code>region_shp()</code> and <code>region_geojson()</code>, respectively, can be passed to <code>as_wkt()</code> to get WKT.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>shp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_shp</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Belgian Exclusive Economic Zone&#34;</span>)
</span></span><span style="display:flex;"><span>wkt <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_as_wkt</span>(shp)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;httr&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;data.table&#39;</span>)
</span></span><span style="display:flex;"><span>args <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(scientificname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Abra alba&#34;</span>, geometry <span style="color:#f92672">=</span> wkt, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> httr<span style="color:#f92672">::</span><span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#39;https://api.iobis.org/occurrence&#39;</span>, query <span style="color:#f92672">=</span> args)
</span></span><span style="display:flex;"><span>xx <span style="color:#f92672">&lt;-</span> data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">setDF</span>(data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">rbindlist</span>(httr<span style="color:#f92672">::</span><span style="color:#a6e22e">content</span>(res)<span style="color:#f92672">$</span>results, use.names <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
</span></span><span style="display:flex;"><span>xx <span style="color:#f92672">&lt;-</span> xx[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#39;scientificName&#39;</span>, <span style="color:#e6db74">&#39;decimalLongitude&#39;</span>, <span style="color:#e6db74">&#39;decimalLatitude&#39;</span>)]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">names</span>(xx)[2<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#39;longitude&#39;</span>, <span style="color:#e6db74">&#39;latitude&#39;</span>)
</span></span></code></pre></div><p>Plot</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;leaflet&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">leaflet</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addTiles</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addCircleMarkers</span>(data <span style="color:#f92672">=</span> xx) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addPolygons</span>(data <span style="color:#f92672">=</span> shp)
</span></span></code></pre></div><p><img alt="map1" loading="lazy" src="/2016-06-09-marine-regions/map1.png"></p>
<h3 id="using-eez-id">Using EEZ ID</h3>
<p>EEZ is a Exclusive Economic Zone</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>(eez <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_obis_eez_id</span>(<span style="color:#e6db74">&#34;Belgian Exclusive Economic Zone&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 59</span>
</span></span></code></pre></div><p>You currently can&rsquo;t search for OBIS occurrences by EEZ ID, but hopefully soon&hellip;</p>
<h2 id="dealing-with-bigger-wkt">Dealing with bigger WKT</h2>
<p>What if you&rsquo;re WKT string is super long?  It&rsquo;s often a problem because some online species
occurrence databases that accept WKT to search by geometry bork due to
limitations on length of URLs if your WKT string is too long (about 8000 characters,
including remainder of URL). One way to deal with it is to reduce detail - simplify.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;rmapshaper&#34;</span>)
</span></span></code></pre></div><p>Using <code>rmapshaper</code> we can simplify a spatial object, then search with that.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>shp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mr_shp</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Dutch Exclusive Economic Zone&#34;</span>)
</span></span></code></pre></div><p>Visualize</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">leaflet</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addTiles</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addPolygons</span>(data <span style="color:#f92672">=</span> shp)
</span></span></code></pre></div><p><img alt="map2" loading="lazy" src="/2016-06-09-marine-regions/complex.png"></p>
<p>Simplify</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;rmapshaper&#34;</span>)
</span></span><span style="display:flex;"><span>shp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ms_simplify</span>(shp)
</span></span></code></pre></div><p>It&rsquo;s simplified:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">leaflet</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addTiles</span>() <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">addPolygons</span>(data <span style="color:#f92672">=</span> shp)
</span></span></code></pre></div><p><img alt="map3" loading="lazy" src="/2016-06-09-marine-regions/simple.png"></p>
<h2 id="pass-to-gbif">Pass to GBIF</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;rgbif&#34;</span>)) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;rgbif&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;rgbif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">occ_search</span>(geometry <span style="color:#f92672">=</span> <span style="color:#a6e22e">mr_as_wkt</span>(shp), limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">400</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Records found [2395936]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Records returned [400]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; No. unique hierarchies [17]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; No. media records [3]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Args [geometry=POLYGON ((7.2083632399999997 53.2428091399999985,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      6.6974995100000001 53.4619365499999972, 5.89083650, limit=400,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      offset=0, fields=all]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; # A tibble: 400 x 102</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                     name        key decimalLatitude decimalLongitude</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                    &lt;chr&gt;      &lt;int&gt;           &lt;dbl&gt;            &lt;dbl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1  Haematopus ostralegus 1265900666        52.13467          4.21306</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2          Limosa limosa 1265577408        53.03249          4.88665</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3       Corvus splendens 1269536058        51.98297          4.12982</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4       Corvus splendens 1269536065        51.98297          4.12982</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5       Lanius excubitor 1211320606        52.57223          4.62569</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6       Lanius excubitor 1211320862        52.67419          4.63645</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7       Lanius excubitor 1211320806        53.05790          4.72974</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 8       Lanius excubitor 1211321040        52.57540          4.63651</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 9       Lanius excubitor 1211320590        52.41180          5.19500</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 10      Lanius excubitor 1211320401        52.57535          4.63654</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; # ... with 390 more rows, and 98 more variables: issues &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   datasetKey &lt;chr&gt;, publishingOrgKey &lt;chr&gt;, publishingCountry &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   protocol &lt;chr&gt;, lastCrawled &lt;chr&gt;, lastParsed &lt;chr&gt;, extensions &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   basisOfRecord &lt;chr&gt;, taxonKey &lt;int&gt;, kingdomKey &lt;int&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   phylumKey &lt;int&gt;, classKey &lt;int&gt;, orderKey &lt;int&gt;, familyKey &lt;int&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   genusKey &lt;int&gt;, speciesKey &lt;int&gt;, scientificName &lt;chr&gt;, kingdom &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   phylum &lt;chr&gt;, order &lt;chr&gt;, family &lt;chr&gt;, genus &lt;chr&gt;, species &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   genericName &lt;chr&gt;, specificEpithet &lt;chr&gt;, taxonRank &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   dateIdentified &lt;chr&gt;, coordinateUncertaintyInMeters &lt;dbl&gt;, year &lt;int&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   month &lt;int&gt;, day &lt;int&gt;, eventDate &lt;chr&gt;, modified &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   lastInterpreted &lt;chr&gt;, references &lt;chr&gt;, identifiers &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   facts &lt;chr&gt;, relations &lt;chr&gt;, geodeticDatum &lt;chr&gt;, class &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   countryCode &lt;chr&gt;, country &lt;chr&gt;, rightsHolder &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   identifier &lt;chr&gt;, informationWithheld &lt;chr&gt;, verbatimEventDate &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   datasetName &lt;chr&gt;, gbifID &lt;chr&gt;, collectionCode &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   verbatimLocality &lt;chr&gt;, occurrenceID &lt;chr&gt;, taxonID &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   license &lt;chr&gt;, recordedBy &lt;chr&gt;, catalogNumber &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   http...unknown.org.occurrenceDetails &lt;chr&gt;, institutionCode &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   rights &lt;chr&gt;, eventTime &lt;chr&gt;, identificationID &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   individualCount &lt;int&gt;, continent &lt;chr&gt;, stateProvince &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   nomenclaturalCode &lt;chr&gt;, locality &lt;chr&gt;, language &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   taxonomicStatus &lt;chr&gt;, type &lt;chr&gt;, preparations &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   disposition &lt;chr&gt;, originalNameUsage &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   bibliographicCitation &lt;chr&gt;, identifiedBy &lt;chr&gt;, sex &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   lifeStage &lt;chr&gt;, otherCatalogNumbers &lt;chr&gt;, habitat &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   georeferencedBy &lt;chr&gt;, vernacularName &lt;chr&gt;, elevation &lt;dbl&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   minimumDistanceAboveSurfaceInMeters &lt;chr&gt;, dynamicProperties &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   samplingEffort &lt;chr&gt;, organismName &lt;chr&gt;, georeferencedDate &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   georeferenceProtocol &lt;chr&gt;, georeferenceVerificationStatus &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   organismID &lt;chr&gt;, ownerInstitutionCode &lt;chr&gt;, samplingProtocol &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   datasetID &lt;chr&gt;, accessRights &lt;chr&gt;, georeferenceSources &lt;chr&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   elevationAccuracy &lt;dbl&gt;, depth &lt;dbl&gt;, depthAccuracy &lt;dbl&gt;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; #   waterBody &lt;chr&gt;</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    <item>
      <title>lawn - a new package to do geospatial analysis</title>
      <link>http://localhost:1313/2015/05/mow-the-lawn/</link>
      <pubDate>Mon, 18 May 2015 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2015/05/mow-the-lawn/</guid>
      <description>&lt;p&gt;&lt;code&gt;lawn&lt;/code&gt; is an R wrapper for the Javascript library &lt;a href=&#34;http://turfjs.org/&#34;&gt;turf.js&lt;/a&gt; for advanced geospatial analysis. In addition, we have a few functions to interface with the &lt;a href=&#34;https://github.com/mapbox/geojson-random&#34;&gt;geojson-random&lt;/a&gt; Javascript library.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;lawn&lt;/code&gt; includes traditional spatial operations, helper functions for creating GeoJSON data, and data classification and statistics tools.&lt;/p&gt;
&lt;p&gt;There is an additional helper function (see &lt;code&gt;view()&lt;/code&gt;) in this package to help visualize data with interactive maps via the &lt;code&gt;leaflet&lt;/code&gt; package (&lt;a href=&#34;https://github.com/rstudio/leaflet&#34;&gt;https://github.com/rstudio/leaflet&lt;/a&gt;). Note that &lt;code&gt;leaflet&lt;/code&gt; is not required to install &lt;code&gt;lawn&lt;/code&gt; - it&amp;rsquo;s in Suggests, not Imports or Depends.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p><code>lawn</code> is an R wrapper for the Javascript library <a href="http://turfjs.org/">turf.js</a> for advanced geospatial analysis. In addition, we have a few functions to interface with the <a href="https://github.com/mapbox/geojson-random">geojson-random</a> Javascript library.</p>
<p><code>lawn</code> includes traditional spatial operations, helper functions for creating GeoJSON data, and data classification and statistics tools.</p>
<p>There is an additional helper function (see <code>view()</code>) in this package to help visualize data with interactive maps via the <code>leaflet</code> package (<a href="https://github.com/rstudio/leaflet">https://github.com/rstudio/leaflet</a>). Note that <code>leaflet</code> is not required to install <code>lawn</code> - it&rsquo;s in Suggests, not Imports or Depends.</p>
<p>Use cases for this package include (but not limited to, obs.) the following (all below assumes GeoJSON format):</p>
<ul>
<li>Create random spatial data.</li>
<li>Convert among spatial data types (e.g. <code>Polygon</code> to <code>FeatureCollection</code>)</li>
<li>Transform objects, including merging many, simplifying, calculating hulls, etc.</li>
<li>Measuring objects</li>
<li>Performing interpolation of objects</li>
<li>Aggregating data (aka properties) associated with objects</li>
</ul>
<h2 id="install">Install</h2>
<p>Stable <code>lawn</code> version from CRAN - this should fetch <code>leaflet</code>, which is not on CRAN, but in a <code>drat</code> repo (let me know if it doesn&rsquo;t)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;lawn&#34;</span>)
</span></span></code></pre></div><p>Or, the development version from Github</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;ropensci/lawn&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;lawn&#34;</span>)
</span></span></code></pre></div><h2 id="view">view</h2>
<p><code>lawn</code> includes a tiny helper function for visualizing geojson. For examples below, we&rsquo;ll make liberal use of the <code>lawn::view()</code> function to visualize what it is the heck we&rsquo;re doing. mkay, lets roll&hellip;</p>
<p>We&rsquo;ve tried to make <code>view()</code> work with as many inputs as possible, from class <code>character</code> containing
json to the class <code>json</code> from the <code>jsonlite</code> package, to the class <code>list</code> to all of the GeoJSON outputs
from functions in <code>lawn</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">view</span>(lawn_data<span style="color:#f92672">$</span>points_average)
</span></span></code></pre></div><p><img alt="map1" loading="lazy" src="/2015-05-18-mow-the-lawn/map1.png"></p>
<p>Here, we sample at random two points from the same dataset just viewed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_sample</span>(lawn_data<span style="color:#f92672">$</span>points_average, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">view</span>()
</span></span></code></pre></div><p><img alt="map2" loading="lazy" src="/2015-05-18-mow-the-lawn/map2.png"></p>
<h2 id="make-some-geojson-data">Make some geojson data</h2>
<p>Point</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_point</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-74.5</span>, <span style="color:#ae81ff">40</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Point&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry$coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -74.5  40.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $properties</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; named list()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;point&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_point</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-74.5</span>, <span style="color:#ae81ff">40</span>)) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="point" loading="lazy" src="/2015-05-18-mow-the-lawn/point.png"></p>
<p>Polygon</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>rings <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2.275543</span>, <span style="color:#ae81ff">53.464547</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2.275543</span>, <span style="color:#ae81ff">53.489271</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2.215118</span>, <span style="color:#ae81ff">53.489271</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2.215118</span>, <span style="color:#ae81ff">53.464547</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2.275543</span>, <span style="color:#ae81ff">53.464547</span>)
</span></span><span style="display:flex;"><span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lawn_polygon</span>(rings)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Polygon&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry$coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; , , 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1,] -2.275543 -2.275543 -2.215118 -2.215118 -2.275543</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; , , 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;          [,1]     [,2]     [,3]     [,4]     [,5]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1,] 53.46455 53.48927 53.48927 53.46455 53.46455</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $properties</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; named list()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;polygon&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_polygon</span>(rings) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="polygon" loading="lazy" src="/2015-05-18-mow-the-lawn/polygon.png"></p>
<p>Random set of points</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_random</span>(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      type geometry.type  geometry.coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Feature         Point -137.46327, -63.46154</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Feature         Point  -110.68426, 83.10533</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;featurecollection&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_random</span>(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="rand1" loading="lazy" src="/2015-05-18-mow-the-lawn/lawn_random.png"></p>
<p>Or, use a different Javascript library (<a href="https://github.com/mapbox/geojson-random">geojson-random</a>) to create random features.</p>
<p>Positions</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">gr_position</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -179.77996   45.99018</span>
</span></span></code></pre></div><p>Points</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">gr_point</span>(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      type geometry.type geometry.coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Feature         Point   5.83895, -27.77218</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Feature         Point   78.50177, 14.95840</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;featurecollection&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">gr_point</span>(<span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="rand2" loading="lazy" src="/2015-05-18-mow-the-lawn/geojsonrandom_points.png"></p>
<p>Polygons</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">gr_polygon</span>(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, vertices <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, max_radial_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      type geometry.type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Feature       Polygon</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                                           geometry.coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 67.58827, 67.68551, 67.00091, 66.70156, 65.72578, 67.58827, -42.11340, -42.69850, -43.54866, -42.42758, -41.76731, -42.11340</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;featurecollection&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">gr_polygon</span>(n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, vertices <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, max_radial_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="rand3" loading="lazy" src="/2015-05-18-mow-the-lawn/geojsonrandom_polygons.png"></p>
<h2 id="count">count</h2>
<p>Count number of points within polygons, appends a new field to properties (see the <code>count</code> field)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_count</span>(polygons <span style="color:#f92672">=</span> lawn_data<span style="color:#f92672">$</span>polygons_count, points <span style="color:#f92672">=</span> lawn_data<span style="color:#f92672">$</span>points_count)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      type pt_count geometry.type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Feature        2       Polygon</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Feature        0       Polygon</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                           geometry.coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 -112.07239, -112.07239, -112.02810, -112.02810, -112.07239, 46.58659, 46.61761, 46.61761, 46.58659, 46.58659</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 -112.02398, -112.02398, -111.96613, -111.96613, -112.02398, 46.57043, 46.61502, 46.61502, 46.57043, 46.57043</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;featurecollection&#34;</span>
</span></span></code></pre></div><h2 id="distance">distance</h2>
<p>Define two points</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>from <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;properties&#34;: {},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;type&#34;: &#34;Point&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;coordinates&#34;: [-75.343, 39.984]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span><span style="display:flex;"><span>to <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;properties&#34;: {},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;type&#34;: &#34;Point&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;coordinates&#34;: [-75.534, 39.123]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span></code></pre></div><p>Calculate distance, default units is kilometers (default output: <code>km</code>)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_distance</span>(from, to)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 97.15958</span>
</span></span></code></pre></div><h2 id="sample-from-a-featurecollection">sample from a FeatureCollection</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> lawn_data<span style="color:#f92672">$</span>points_average
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cat</span>(dat)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   &#34;type&#34;: &#34;FeatureCollection&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   &#34;features&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;     {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;       &#34;type&#34;: &#34;Feature&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;       &#34;properties&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;         &#34;population&#34;: 200</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;       },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;       &#34;geometry&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;         &#34;type&#34;: &#34;Point&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p>Sample 2 points at random</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_sample</span>(dat, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      type population geometry.type geometry.coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Feature        200         Point   10.80643, 59.90891</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Feature        600         Point   10.71579, 59.90478</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;featurecollection&#34;</span>
</span></span></code></pre></div><h2 id="extent">extent</h2>
<p>Calculates the extent of all input features in a FeatureCollection, and returns a bounding box.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_extent</span>(lawn_data<span style="color:#f92672">$</span>points_average)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 10.71579 59.90478 10.80643 59.93162</span>
</span></span></code></pre></div><h2 id="buffer">buffer</h2>
<p>Calculates a buffer for input features for a given radius.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;properties&#34;: {},
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     &#34;type&#34;: &#34;Polygon&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     &#34;coordinates&#34;: [[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       [-112.072391,46.586591],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       [-112.072391,46.61761],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       [-112.028102,46.61761],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       [-112.028102,46.586591],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       [-112.072391,46.586591]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     ]]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">view</span>(dat)
</span></span></code></pre></div><p><img alt="buffer1" loading="lazy" src="/2015-05-18-mow-the-lawn/buffer1.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_buffer</span>(dat, <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;miles&#34;</span>) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="buffer2" loading="lazy" src="/2015-05-18-mow-the-lawn/buffer2.png"></p>
<h2 id="union-polygons-together">Union polygons together</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>poly1 <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;fill&#34;: &#34;#0f0&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;type&#34;: &#34;Polygon&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;coordinates&#34;: [[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.801742, 45.48565],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.801742, 45.60491],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.584762, 45.60491],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.584762, 45.48565],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.801742, 45.48565]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ]]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>poly2 <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;fill&#34;: &#34;#00f&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;type&#34;: &#34;Polygon&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &#34;coordinates&#34;: [[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.520217, 45.535693],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.64038, 45.553967],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.720031, 45.526554],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.669906, 45.507309],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.723464, 45.446643],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.532577, 45.408574],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.487258, 45.477466],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     [-122.520217, 45.535693]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     ]]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">view</span>(poly1)
</span></span></code></pre></div><p><img alt="union1" loading="lazy" src="/2015-05-18-mow-the-lawn/union1.png"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">view</span>(poly2)
</span></span></code></pre></div><p><img alt="union2" loading="lazy" src="/2015-05-18-mow-the-lawn/union2.png"></p>
<p>Visualize union-ed polygons</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lawn_union</span>(poly1, poly2) <span style="color:#f92672">%&gt;%</span> view
</span></span></code></pre></div><p><img alt="union3" loading="lazy" src="/2015-05-18-mow-the-lawn/union3.png"></p>
<p>See also <code>lawn_merge()</code> and <code>lawn_intersect()</code>.</p>
<h2 id="lint-input-geojson">lint input geojson</h2>
<p>For most functions, you can lint your input geojson data to make sure it is proper geojson. We use
the javascript library <a href="https://github.com/mapbox/geojsonhint">geojsonhint</a>. See the <code>lint</code> parameter.</p>
<p>Good GeoJSON</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;type&#34;: &#34;FeatureCollection&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;features&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;population&#34;: 200
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;type&#34;: &#34;Point&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;coordinates&#34;: [10.724029, 59.926807]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lawn_extent</span>(dat)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 10.72403 59.92681 10.72403 59.92681</span>
</span></span></code></pre></div><p>Bad GeoJSON</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;type&#34;: &#34;FeatureCollection&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#34;features&#34;: [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;type&#34;: &#34;Feature&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;properties&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;population&#34;: 200
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &#34;geometry&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;type&#34;: &#34;Point&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lawn_extent</span>(dat, lint <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Error: Line 1 - &#34;coordinates&#34; property required</span>
</span></span></code></pre></div><h2 id="to-do">To do</h2>
<ul>
<li>As Turf.js changes, we&rsquo;ll update <code>lawn</code></li>
<li>Performance improvements. We realize that this package is slower than the C based <code>rgdal</code>/<code>rgeos</code> - we are looking into ways to increaes performance to get closer to the performance of those packages.</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>geojsonio - a new package to do geojson things</title>
      <link>http://localhost:1313/2015/04/geojson-io/</link>
      <pubDate>Thu, 30 Apr 2015 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2015/04/geojson-io/</guid>
      <description>&lt;p&gt;&lt;code&gt;geojsonio&lt;/code&gt; converts geographic data to GeoJSON and TopoJSON formats - though the focus is mostly on GeoJSON&lt;/p&gt;
&lt;p&gt;For those not familiar GeoJSON it is a format for encoding a variety of geographic data structures. GeoJSON supports the following geometry types: Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon, and GeometryCollection. These geometry types are also found in &lt;a href=&#34;https://en.wikipedia.org/wiki/Well-known_text&#34;&gt;well known text (WKT)&lt;/a&gt;, and have equivalents in R&amp;rsquo;s spatial classes. Read the &lt;a href=&#34;https://geojson.org/geojson-spec.html&#34;&gt;spec&lt;/a&gt; for more detailed information.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p><code>geojsonio</code> converts geographic data to GeoJSON and TopoJSON formats - though the focus is mostly on GeoJSON</p>
<p>For those not familiar GeoJSON it is a format for encoding a variety of geographic data structures. GeoJSON supports the following geometry types: Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon, and GeometryCollection. These geometry types are also found in <a href="https://en.wikipedia.org/wiki/Well-known_text">well known text (WKT)</a>, and have equivalents in R&rsquo;s spatial classes. Read the <a href="https://geojson.org/geojson-spec.html">spec</a> for more detailed information.</p>
<p>Other great geojson resources:</p>
<ul>
<li>GeoJSON lint - lint your geojson - <a href="https://geojsonlint.com/">https://geojsonlint.com/</a></li>
<li>GeoJSON.io - make maps with geojson input or draw maps and get geojson - <a href="https://geojson.io/">https://geojson.io/</a></li>
</ul>
<p>Functions in this package are organized first around what you&rsquo;re working with or want to get, geojson or topojson, then convert to or read from various formats:</p>
<ul>
<li><code>geojson_list()</code> - convert to GeoJSON as R list format</li>
<li><code>geojson_json()</code> - convert to GeoJSON as json</li>
<li><code>geojson_read()</code>/<code>topojson_read()</code> - read a GeoJSON/TopoJSON file from file path or URL</li>
<li><code>geojson_write()</code> - write a GeoJSON file locally (no write TopoJSON yet)</li>
</ul>
<p>Each of the above functions have methods for various objects/classes, including <code>numeric</code>, <code>data.frame</code>, <code>list</code>, <code>SpatialPolygons</code>, <code>SpatialLines</code>, <code>SpatialPoints</code>, etc. (including the classes in <code>rgeos</code>)</p>
<p>Use cases for this package include (but not limited to, obs.) the following:</p>
<ul>
<li>Get data in GeoJSON json format, and you want to get it into a list in R.</li>
<li>Get data into GeoJSON format to use downstream to make a interactive map
<ul>
<li>in R (e.g., with <a href="https://github.com/rstudio/leaflet">leaflet</a>)</li>
<li>or in another context (e.g., using javascript with mapbox/leaflet)</li>
</ul>
</li>
<li>Data is in a data.frame/matrix/list and you want to make GeoJSON format data.</li>
<li>Data is in one of the many spatial classes (e.g., <code>SpatialPoints</code>) and you want GeoJSON</li>
<li>You need to add styling to your data - can do with this package for certain data types.</li>
<li>You want to check that your GeoJSON data is valid - two ways to do it in geojsonio.</li>
<li>Combine objects together (e.g., a point and a line), either from two <code>geo_list</code> objects, or two <code>json</code> objects. See <code>?geojson-add</code></li>
</ul>
<h2 id="install">Install</h2>
<p>See the github repo for notes about dependencies <a href="https://github.com/ropensci/geojsonio#install">https://github.com/ropensci/geojsonio#install</a></p>
<p>CRAN version or the dev version from GitHub</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;geojsonio&#34;</span>)
</span></span><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;sckott/geojsonio&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;geojsonio&#34;</span>)
</span></span></code></pre></div><h2 id="geojson">GeoJSON</h2>
<h3 id="convert-various-formats-to-geojson">Convert various formats to geojson</h3>
<p>From a <code>numeric</code> vector of length 2</p>
<p>as <em>json</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">32.45</span>, <span style="color:#ae81ff">-99.74</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;FeatureCollection&#34;,&#34;features&#34;:[{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[32.45,-99.74]},&#34;properties&#34;:{}}]}</span>
</span></span></code></pre></div><p>as a <strong>list</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">32.45</span>, <span style="color:#ae81ff">-99.74</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p>From a <code>data.frame</code></p>
<p>as <strong>json</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(us_cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, ], lat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;lat&#39;</span>, lon <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;FeatureCollection&#34;,&#34;features&#34;:[{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[-99.74,32.45]},&#34;properties&#34;:{&#34;name&#34;:&#34;Abilene TX&#34;,&#34;country.etc&#34;:&#34;TX&#34;,&#34;pop&#34;:&#34;113888&#34;,&#34;capital&#34;:&#34;0&#34;}},{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[-81.52,41.08]},&#34;properties&#34;:{&#34;name&#34;:&#34;Akron OH&#34;,&#34;country.etc&#34;:&#34;OH&#34;,&#34;pop&#34;:&#34;206634&#34;,&#34;capital&#34;:&#34;0&#34;}}]}</span>
</span></span></code></pre></div><p>as a <strong>list</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(us_cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, ], lat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;lat&#39;</span>, lon <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p>From <code>SpatialPolygons</code> class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;sp&#39;</span>)
</span></span><span style="display:flex;"><span>poly1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Polygons</span>(<span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">Polygon</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-100</span>, <span style="color:#ae81ff">-90</span>, <span style="color:#ae81ff">-85</span>, <span style="color:#ae81ff">-100</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">40</span>)))), <span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>poly2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Polygons</span>(<span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">Polygon</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-90</span>, <span style="color:#ae81ff">-80</span>, <span style="color:#ae81ff">-75</span>, <span style="color:#ae81ff">-90</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">30</span>)))), <span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>(sp_poly <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">SpatialPolygons</span>(<span style="color:#a6e22e">list</span>(poly1, poly2), <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; An object of class &#34;SpatialPolygons&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Slot &#34;polygons&#34;:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; An object of class &#34;Polygons&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Slot &#34;Polygons&#34;:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; An object of class &#34;Polygon&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Slot &#34;labpt&#34;:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -91.66667  45.00000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p>to <strong>json</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(sp_poly)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;FeatureCollection&#34;,&#34;features&#34;:[{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:1,&#34;properties&#34;:{&#34;dummy&#34;:0},&#34;geometry&#34;:{&#34;type&#34;:&#34;Polygon&#34;,&#34;coordinates&#34;:[[[-100,40],[-90,50],[-85,45],[-100,40]]]}},{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:2,&#34;properties&#34;:{&#34;dummy&#34;:0},&#34;geometry&#34;:{&#34;type&#34;:&#34;Polygon&#34;,&#34;coordinates&#34;:[[[-90,30],[-80,40],[-75,35],[-90,30]]]}}]}</span>
</span></span></code></pre></div><p>to a <strong>list</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(sp_poly)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p>From <code>SpatialPoints</code> class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>(s <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">SpatialPoints</span>(<span style="color:#a6e22e">cbind</span>(x, y)))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; SpatialPoints:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;      x y</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1,] 1 3</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [2,] 2 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [3,] 3 5</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [4,] 4 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [5,] 5 4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Coordinate Reference System (CRS) arguments: NA</span>
</span></span></code></pre></div><p>to <strong>json</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(s)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;FeatureCollection&#34;,&#34;features&#34;:[{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:1,&#34;properties&#34;:{&#34;dat&#34;:1},&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[1,3]}},{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:2,&#34;properties&#34;:{&#34;dat&#34;:2},&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[2,2]}},{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:3,&#34;properties&#34;:{&#34;dat&#34;:3},&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[3,5]}},{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:4,&#34;properties&#34;:{&#34;dat&#34;:4},&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[4,1]}},{&#34;type&#34;:&#34;Feature&#34;,&#34;id&#34;:5,&#34;properties&#34;:{&#34;dat&#34;:5},&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[5,4]}}]}</span>
</span></span></code></pre></div><p>to a <strong>list</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(s)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><h3 id="combine-objects">Combine objects</h3>
<p><code>geo_list</code> + <code>geo_list</code></p>
<blockquote>
<p>Note: <code>geo_list</code> is the output type from <code>geojson_list()</code>, it&rsquo;s just a list with a class attached so we know it&rsquo;s geojson :)</p></blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>vec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-99.74</span>, <span style="color:#ae81ff">32.45</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">geojson_list</span>(vec)
</span></span><span style="display:flex;"><span>vecs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">100.0</span>, <span style="color:#ae81ff">0.0</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">101.0</span>, <span style="color:#ae81ff">0.0</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">100.0</span>, <span style="color:#ae81ff">0.0</span>))
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">geojson_list</span>(vecs, geometry <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;polygon&#34;</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">+</span> b
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">...</span>
</span></span></code></pre></div><p><code>json</code> + <code>json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>c <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">geojson_json</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-99.74</span>, <span style="color:#ae81ff">32.45</span>))
</span></span><span style="display:flex;"><span>vecs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">100.0</span>, <span style="color:#ae81ff">0.0</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">101.0</span>, <span style="color:#ae81ff">0.0</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">101.0</span>, <span style="color:#ae81ff">1.0</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">100.0</span>, <span style="color:#ae81ff">1.0</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">100.0</span>, <span style="color:#ae81ff">0.0</span>))
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">geojson_json</span>(vecs, geometry <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;polygon&#34;</span>)
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">+</span> d
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;FeatureCollection&#34;,&#34;features&#34;:[{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[-99.74,32.45]},&#34;properties&#34;:{}},{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Polygon&#34;,&#34;coordinates&#34;:[[[100,0],[101,0],[101,1],[100,1],[100,0]]]},&#34;properties&#34;:[]}]}</span>
</span></span></code></pre></div><h3 id="write-geojson">Write geojson</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_write</span>(us_cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, ], lat <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;lat&#39;</span>, lon <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; &lt;geojson&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   Path:       myfile.geojson</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   From class: data.frame</span>
</span></span></code></pre></div><h2 id="topojson">Topojson</h2>
<p>In the current version of this package you can read topojson. Writing topojson was in this package, but is gone for now - will come back later as in interface to <a href="https://github.com/mbostock/topojson">topojson</a> via <a href="https://github.com/jeroenooms/V8">V8</a>.</p>
<p>Read from a file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>file <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.file</span>(<span style="color:#e6db74">&#34;examples&#34;</span>, <span style="color:#e6db74">&#34;us_states.topojson&#34;</span>, package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;geojsonio&#34;</span>)
</span></span><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">topojson_read</span>(file)
</span></span></code></pre></div><p>Read from a URL</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>url <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson&#34;</span>
</span></span><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">topojson_read</span>(url)
</span></span></code></pre></div><h2 id="lint-geojson">Lint geojson</h2>
<p>There are two ways to do this in this package.</p>
<h3 id="lint-locally">lint, locally</h3>
<p>Uses the javascript library <a href="https://github.com/mapbox/geojsonhint">geojsonhint</a> from Mapbox. We&rsquo;re running this locally via the <a href="https://cran.rstudio.com/web/packages/V8/">V8</a> package.</p>
<p>Good</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lint</span>(<span style="color:#e6db74">&#39;{&#34;type&#34;: &#34;Point&#34;, &#34;coordinates&#34;: [-100, 80]}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;valid&#34;</span>
</span></span></code></pre></div><p>Bad</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">lint</span>(<span style="color:#e6db74">&#39;{&#34;type&#34;: &#34;Rhombus&#34;, &#34;coordinates&#34;: [[1, 2], [3, 4], [5, 6]]}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $message</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;The type Rhombus is unknown&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $line</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 1</span>
</span></span></code></pre></div><h3 id="validate-with-a-web-service">validate, with a web service</h3>
<p>Uses the web service at <a href="https://geojsonlint.com/">https://geojsonlint.com/</a></p>
<p>Good</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(<span style="color:#e6db74">&#39;{&#34;type&#34;: &#34;Point&#34;, &#34;coordinates&#34;: [-100, 80]}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;ok&#34;</span>
</span></span></code></pre></div><p>Bad</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(<span style="color:#e6db74">&#39;{&#34;type&#34;: &#34;Rhombus&#34;, &#34;coordinates&#34;: [[1, 2], [3, 4], [5, 6]]}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $message</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;\&#34;Rhombus\&#34; is not a valid GeoJSON type.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;error&#34;</span>
</span></span></code></pre></div><h2 id="to-do">To do</h2>
<ul>
<li>I&rsquo;d like to replace <code>rgdal</code> with javascript libraries to read from various file types (kml, shp, etc.) and convert to geojson. This is <a href="https://github.com/ropensci/geojsonio/tree/js">in development</a>, and will come in the next version of this package most likely. This should make installation a bit easier as we won&rsquo;t have to depend on <code>rgdal</code> and <code>GDAL</code></li>
<li>Performance improvements. Some operations already use the gdal or geos C libraries, so are quite fast, though the round trip to disk and back does take significant time. I&rsquo;d like to speed this up.</li>
<li>More input types. We already have operations (json, list, etc.) for lots of input types (data.frame, list, sp classes), but likely there will be more added.</li>
<li>Most likely add functions <code>topojson_list()</code>, <code>topojson_json()</code></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>R I/O for geojson and topojson</title>
      <link>http://localhost:1313/2015/01/geojson-topojson-io/</link>
      <pubDate>Tue, 06 Jan 2015 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2015/01/geojson-topojson-io/</guid>
      <description>&lt;p&gt;At rOpenSci we&amp;rsquo;ve been working on an R package (&lt;code&gt;geojsonio&lt;/code&gt;) to make converting R data in various formats to &lt;a href=&#34;https://geojson.org/geojson-spec.html&#34;&gt;geoJSON&lt;/a&gt; and &lt;a href=&#34;https://github.com/topojson/topojson-specification/blob/master/README.md&#34;&gt;topoJSON&lt;/a&gt;, and vice versa. We hope to do this one job very well, and handle all reasonable use cases.&lt;/p&gt;
&lt;p&gt;Functions in this package are organized first around what you&amp;rsquo;re working with or want to get, &lt;code&gt;geojson&lt;/code&gt; or &lt;code&gt;topojson&lt;/code&gt;, then convert to or read from various formats:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;geojson_list()&lt;/code&gt;/&lt;code&gt;topojson_list()&lt;/code&gt; - convert to geojson/topojson as R list format&lt;/li&gt;
&lt;li&gt;&lt;code&gt;geojson_json()&lt;/code&gt;/&lt;code&gt;topojson_json()&lt;/code&gt; - convert to geojson/topojson as json&lt;/li&gt;
&lt;li&gt;&lt;code&gt;geojson_read()``topojson_read()&lt;/code&gt; - read a geojson/topojson file from file path or URL&lt;/li&gt;
&lt;li&gt;&lt;code&gt;geojson_write()&lt;/code&gt;/&lt;code&gt;topojson_write()&lt;/code&gt; - write a geojson/topojson file locally&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Each of the above functions have methods for various objects/classes, including &lt;code&gt;numeric&lt;/code&gt;, &lt;code&gt;data.frame&lt;/code&gt;, &lt;code&gt;list&lt;/code&gt;, &lt;code&gt;SpatialPolygons&lt;/code&gt;, &lt;code&gt;SpatialPolygonsDataFrame&lt;/code&gt;, &lt;code&gt;SpatialLines&lt;/code&gt;, &lt;code&gt;SpatialLinesDataFrame&lt;/code&gt;, &lt;code&gt;SpatialPoints&lt;/code&gt;, &lt;code&gt;SpatialPointsDataFrame&lt;/code&gt;.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>At rOpenSci we&rsquo;ve been working on an R package (<code>geojsonio</code>) to make converting R data in various formats to <a href="https://geojson.org/geojson-spec.html">geoJSON</a> and <a href="https://github.com/topojson/topojson-specification/blob/master/README.md">topoJSON</a>, and vice versa. We hope to do this one job very well, and handle all reasonable use cases.</p>
<p>Functions in this package are organized first around what you&rsquo;re working with or want to get, <code>geojson</code> or <code>topojson</code>, then convert to or read from various formats:</p>
<ul>
<li><code>geojson_list()</code>/<code>topojson_list()</code> - convert to geojson/topojson as R list format</li>
<li><code>geojson_json()</code>/<code>topojson_json()</code> - convert to geojson/topojson as json</li>
<li><code>geojson_read()``topojson_read()</code> - read a geojson/topojson file from file path or URL</li>
<li><code>geojson_write()</code>/<code>topojson_write()</code> - write a geojson/topojson file locally</li>
</ul>
<p>Each of the above functions have methods for various objects/classes, including <code>numeric</code>, <code>data.frame</code>, <code>list</code>, <code>SpatialPolygons</code>, <code>SpatialPolygonsDataFrame</code>, <code>SpatialLines</code>, <code>SpatialLinesDataFrame</code>, <code>SpatialPoints</code>, <code>SpatialPointsDataFrame</code>.</p>
<h2 id="install">Install</h2>
<p>Install rgdal - in case you can&rsquo;t get it installed from binary , here&rsquo;s what works on a Mac.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;https://cran.r-project.org/src/contrib/rgdal_0.9-1.tar.gz&#34;</span>, repos <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;source&#34;</span>, configure.args <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--with-gdal-config=/Library/Frameworks/GDAL.framework/Versions/1.10/unix/bin/gdal-config --with-proj-include=/Library/Frameworks/PROJ.framework/unix/include --with-proj-lib=/Library/Frameworks/PROJ.framework/unix/lib&#34;</span>)
</span></span></code></pre></div><p>Install <code>geojsonio</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;devtools&#34;</span>)
</span></span><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;ropensci/geojsonio&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;geojsonio&#34;</span>)
</span></span></code></pre></div><h2 id="geojson">GeoJSON</h2>
<h3 id="convert-various-formats-to-geojson">Convert various formats to geojson</h3>
<p>From a <code>numeric</code> vector of length 2, as json or list</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">32.45</span>,<span style="color:#ae81ff">-99.74</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;Point&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[32.45,-99.74]},&#34;properties&#34;:{}}</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">32.45</span>,<span style="color:#ae81ff">-99.74</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Point&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Point&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $geometry$coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1]  32.45 -99.74</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $properties</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;geo_list&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;from&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;numeric&#34;</span>
</span></span></code></pre></div><p>From a <code>data.frame</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;maps&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span>(us.cities)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(us.cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>,], lat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lat&#39;</span>, lon<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;FeatureCollection&#34;,&#34;features&#34;:[{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[-99.74,32.45]},&#34;properties&#34;:{&#34;name&#34;:&#34;Abilene TX&#34;,&#34;country.etc&#34;:&#34;TX&#34;,&#34;pop&#34;:&#34;113888&#34;,&#34;capital&#34;:&#34;0&#34;}},{&#34;type&#34;:&#34;Feature&#34;,&#34;geometry&#34;:{&#34;type&#34;:&#34;Point&#34;,&#34;coordinates&#34;:[-81.52,41.08]},&#34;properties&#34;:{&#34;name&#34;:&#34;Akron OH&#34;,&#34;country.etc&#34;:&#34;OH&#34;,&#34;pop&#34;:&#34;206634&#34;,&#34;capital&#34;:&#34;0&#34;}}]}</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(us.cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>,], lat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lat&#39;</span>, lon<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;FeatureCollection&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Point&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$geometry$coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -99.74  32.45</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$properties</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$properties$name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Abilene TX&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$properties$country.etc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;TX&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$properties$pop</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;113888&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[1]]$properties$capital</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Feature&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$geometry</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$geometry$type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Point&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$geometry$coordinates</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -81.52  41.08</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$properties</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$properties$name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Akron OH&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$properties$country.etc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;OH&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$properties$pop</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;206634&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $features[[2]]$properties$capital</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;geo_list&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;from&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;data.frame&#34;</span>
</span></span></code></pre></div><p>From <code>SpatialPolygons</code> class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;sp&#39;</span>)
</span></span><span style="display:flex;"><span>poly1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Polygons</span>(<span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">Polygon</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-100</span>,<span style="color:#ae81ff">-90</span>,<span style="color:#ae81ff">-85</span>,<span style="color:#ae81ff">-100</span>),
</span></span><span style="display:flex;"><span>                                     <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">40</span>,<span style="color:#ae81ff">50</span>,<span style="color:#ae81ff">45</span>,<span style="color:#ae81ff">40</span>)))), <span style="color:#e6db74">&#34;1&#34;</span>)
</span></span><span style="display:flex;"><span>poly2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Polygons</span>(<span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">Polygon</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-90</span>,<span style="color:#ae81ff">-80</span>,<span style="color:#ae81ff">-75</span>,<span style="color:#ae81ff">-90</span>),
</span></span><span style="display:flex;"><span>                                     <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">30</span>,<span style="color:#ae81ff">40</span>,<span style="color:#ae81ff">35</span>,<span style="color:#ae81ff">30</span>)))), <span style="color:#e6db74">&#34;2&#34;</span>)
</span></span><span style="display:flex;"><span>sp_poly <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">SpatialPolygons</span>(<span style="color:#a6e22e">list</span>(poly1, poly2), <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><p>to json</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_json</span>(sp_poly)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; {&#34;type&#34;:&#34;Polygon&#34;,&#34;bbox&#34;:[-100,-75,30,50],&#34;coordinates&#34;:[[[-100,40],[-90,50],[-85,45],[-100,40]],[[-90,30],[-80,40],[-75,35],[-90,30]]],&#34;properties&#34;:{}}</span>
</span></span></code></pre></div><p>to list</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">geojson_list</span>(sp_poly)<span style="color:#f92672">$</span>coordinates[[1]]
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]][[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -100</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]][[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 40</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[2]][[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -90</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[2]][[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 50</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[3]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[3]][[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -85</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[3]][[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 45</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[4]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[4]][[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] -100</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[4]][[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 40</span>
</span></span></code></pre></div><h3 id="write-geojson">Write geojson</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;maps&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span>(us.cities)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">geojson_write</span>(us.cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>,], lat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lat&#39;</span>, lon<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; &lt;geojson&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   Path:       myfile.geojson</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   From class: data.frame</span>
</span></span></code></pre></div><h3 id="read-geojson">Read geojson</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>file <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.file</span>(<span style="color:#e6db74">&#34;examples&#34;</span>, <span style="color:#e6db74">&#34;california.geojson&#34;</span>, package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;geojsonio&#34;</span>)
</span></span><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">geojson_read</span>(file)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; OGR data source with driver: GeoJSON </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Source: &#34;/Users/sacmac/Library/R/3.1/library/geojsonio/examples/california.geojson&#34;, layer: &#34;OGRGeoJSON&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; with 1 features and 11 fields</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Feature type: wkbMultiPolygon with 2 dimensions</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(out)
</span></span></code></pre></div><p><img alt="plot of chunk unnamed-chunk-11" loading="lazy" src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-11-1.png"></p>
<h2 id="topojson">TopoJSON</h2>
<h3 id="convert-to-topojson-with-node-topojson-client">Convert to TopoJSON with Node topojson client</h3>
<p>For topojson you will need Mike Bostock&rsquo;s command line client. Install it by doing</p>
<pre tabindex="0"><code>sudo npm install -g topojson
</code></pre><p>Download a zipped shape fileset, <a href="https://esp.cr.usgs.gov/data/little/querwisl.zip">this one</a> for distribution of <em>Quercus wislizeni</em>. Unzip the zip file to a folder. Then do (changing the path to your path)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">topojson_write</span>(shppath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;~/Downloads/querwisl&#39;</span>, path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;~/Downloads&#34;</span>, projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;albers&#39;</span>, projargs<span style="color:#f92672">=</span><span style="color:#a6e22e">list</span>(rotate<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;[60, -35, 0]&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; OGR data source with driver: ESRI Shapefile </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Source: &#34;/Users/sacmac/Downloads/querwisl&#34;, layer: &#34;querwisl&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; with 35 features and 5 fields</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Feature type: wkbPolygon with 2 dimensions</span>
</span></span></code></pre></div><p>Which prints progress on the conversion of the shape file. And prints the topojson CLI call, including the location of the output file, here <code>/Users/sacmac/querwisl.json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>OGR data source with driver<span style="color:#f92672">:</span> ESRI Shapefile
</span></span><span style="display:flex;"><span>Source<span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;/Users/sacmac/Downloads/querwisl&#34;</span>, layer<span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;querwisl&#34;</span>
</span></span><span style="display:flex;"><span>with <span style="color:#ae81ff">35</span> features and <span style="color:#ae81ff">5</span> fields
</span></span><span style="display:flex;"><span>Feature type<span style="color:#f92672">:</span> wkbPolygon with <span style="color:#ae81ff">2</span> dimensions
</span></span><span style="display:flex;"><span>topojson <span style="color:#f92672">-</span>o <span style="color:#f92672">/</span>Users<span style="color:#f92672">/</span>sacmac<span style="color:#f92672">/</span>querwisl.json <span style="color:#f92672">-</span>q <span style="color:#ae81ff">1e4</span> <span style="color:#f92672">-</span>s <span style="color:#ae81ff">0</span> <span style="color:#f92672">--</span>shapefile<span style="color:#f92672">-</span>encoding utf8 <span style="color:#f92672">--</span>projection <span style="color:#e6db74">&#39;d3.geo.albers().rotate([60, -35, 0])&#39;</span> <span style="color:#f92672">--</span> <span style="color:#f92672">/</span>var<span style="color:#f92672">/</span>folders<span style="color:#f92672">/</span>gs<span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>khph0xs0436gmd2gdnwsg080000gn<span style="color:#f92672">/</span>T<span style="color:#f92672">//</span>Rtmp49APW7<span style="color:#f92672">/</span>querwisl.shp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bounds<span style="color:#f92672">:</span> <span style="color:#ae81ff">-403.2554825867553</span> <span style="color:#ae81ff">401.27189387582916</span> <span style="color:#ae81ff">-295.798050380061</span> <span style="color:#ae81ff">585.4214768677039</span> (cartesian)
</span></span><span style="display:flex;"><span>pre<span style="color:#f92672">-</span>quantization<span style="color:#f92672">:</span> <span style="color:#ae81ff">0.010746817902459677</span> <span style="color:#ae81ff">0.018416799979185387</span>
</span></span><span style="display:flex;"><span>topology<span style="color:#f92672">:</span> <span style="color:#ae81ff">35</span> arcs, <span style="color:#ae81ff">2492</span> points
</span></span><span style="display:flex;"><span>prune<span style="color:#f92672">:</span> retained <span style="color:#ae81ff">35</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">35</span> <span style="color:#a6e22e">arcs </span>(<span style="color:#ae81ff">100</span>%)
</span></span></code></pre></div><p>You can then use this topojson file wherever. We&rsquo;ll add a function soon to automagically throw this file up as a Github gist to get an interactive map.</p>
<h3 id="read-topojson">Read topojson</h3>
<p>TopoJSON</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>url <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson&#34;</span>
</span></span><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">topojson_read</span>(url)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; OGR data source with driver: GeoJSON </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Source: &#34;https://raw.githubusercontent.com/shawnbot/d3-cartogram/master/data/us-states.topojson&#34;, layer: &#34;states&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; with 51 features and 2 fields</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Feature type: wkbPolygon with 2 dimensions</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">plot</span>(out)
</span></span></code></pre></div><p><img alt="plot of chunk unnamed-chunk-14" loading="lazy" src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-14-1.png"></p>
<h2 id="use-case-play-with-us-states">Use case: Play with US states</h2>
<p>Using data from <a href="https://github.com/glynnbird/usstatesgeojson">https://github.com/glynnbird/usstatesgeojson</a></p>
<p>Get some geojson</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;httr&#39;</span>)
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">GET</span>(<span style="color:#e6db74">&#39;https://api.github.com/repos/glynnbird/usstatesgeojson/contents&#39;</span>)
</span></span><span style="display:flex;"><span>st_names <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">Filter</span>(<span style="color:#66d9ef">function</span>(x) <span style="color:#a6e22e">grepl</span>(<span style="color:#e6db74">&#34;\\.geojson&#34;</span>, x), <span style="color:#a6e22e">sapply</span>(<span style="color:#a6e22e">content</span>(res), <span style="color:#e6db74">&#34;[[&#34;</span>, <span style="color:#e6db74">&#34;name&#34;</span>))
</span></span><span style="display:flex;"><span>base <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;https://raw.githubusercontent.com/glynnbird/usstatesgeojson/master/&#39;</span>
</span></span><span style="display:flex;"><span>st_files <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(base, st_names)
</span></span></code></pre></div><p>Make a faceted plot</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;ggplot2&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;plyr&#39;</span>)
</span></span><span style="display:flex;"><span>st_use <span style="color:#f92672">&lt;-</span> st_files[7<span style="color:#f92672">:</span><span style="color:#ae81ff">13</span>]
</span></span><span style="display:flex;"><span>geo <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lapply</span>(st_use, geojson_read, verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ldply</span>(<span style="color:#a6e22e">setNames</span>(<span style="color:#a6e22e">lapply</span>(geo, fortify), <span style="color:#a6e22e">gsub</span>(<span style="color:#e6db74">&#34;\\.geojson&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, st_names[7<span style="color:#f92672">:</span><span style="color:#ae81ff">13</span>])))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(df, <span style="color:#a6e22e">aes</span>(long, lat, group <span style="color:#f92672">=</span> group)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_polygon</span>() <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> .id, scales <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;free&#34;</span>)
</span></span></code></pre></div><p><img alt="plot of chunk unnamed-chunk-16" loading="lazy" src="/public/img/2015-01-06-geojson-topojson-io/unnamed-chunk-16-1.png"></p>
<h2 id="maps">Maps</h2>
<p>We&rsquo;re also working on <code>map_gist()</code> - to push up a geojson or topojson file as a GitHub gist (renders as an interactive map). It still needs some work&hellip;</p>
<h2 id="validate-geojson">Validate geojson</h2>
<p><a href="https://geojsonlint.com/">geojsonlint.com</a> has a nice web interface you can use to make sure you&rsquo;re geoJSON is in the right format. In addition, it provides a RESTful endpoint at <code>geojsonlint.com/validate</code> to validate geoJSON.
This was just added today in this package, and can be used from many data types.</p>
<p>Good geoJSON</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(<span style="color:#e6db74">&#39;{&#34;type&#34;: &#34;Point&#34;, &#34;coordinates&#34;: [-100, 80]}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;ok&#34;</span>
</span></span></code></pre></div><p>Bad geoJSON</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(<span style="color:#e6db74">&#39;{&#34;type&#34;: &#34;Rhombus&#34;, &#34;coordinates&#34;: [[1, 2], [3, 4], [5, 6]]}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $message</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;\&#34;Rhombus\&#34; is not a valid GeoJSON type.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;error&#34;</span>
</span></span></code></pre></div><p>A file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>file <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">system.file</span>(<span style="color:#e6db74">&#34;examples&#34;</span>, <span style="color:#e6db74">&#34;zillow_or.geojson&#34;</span>, package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;togeojson&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.location</span>(file))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;ok&#34;</span>
</span></span></code></pre></div><p>A URL</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>url <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/glynnbird/usstatesgeojson/master/california.geojson&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(<span style="color:#a6e22e">as.location</span>(url))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;ok&#34;</span>
</span></span></code></pre></div><p>From the output of <code>geojson_list()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;maps&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span>(us.cities)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">geojson_list</span>(us.cities[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>,], lat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lat&#39;</span>, lon<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;long&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(x)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;ok&#34;</span>
</span></span></code></pre></div><p>From SpatialPoints class</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;sp&#34;</span>)
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">SpatialPoints</span>(<span style="color:#a6e22e">cbind</span>(a,b))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">validate</span>(x)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;ok&#34;</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
  </channel>
</rss>
