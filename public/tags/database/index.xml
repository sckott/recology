<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Database on Recology</title>
    <link>http://localhost:1313/tags/database/</link>
    <description>Recent content in Database on Recology</description>
    <generator>Hugo -- 0.139.3</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 10 Sep 2020 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://localhost:1313/tags/database/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>stories behind archived packages</title>
      <link>http://localhost:1313/2020/09/archived-pkgs/</link>
      <pubDate>Thu, 10 Sep 2020 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2020/09/archived-pkgs/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;Update on 2021-02-09: I&amp;rsquo;ve archived 8 more packages. Post below updated&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;Code is often arranged in packages for any given language. Packages
are often cataloged in a package registry of some kind: NPM for
node, crates.io for Rust, etc. For R, that registry is either
&lt;a href=&#34;https://cran.r-project.org/&#34;&gt;CRAN&lt;/a&gt; or &lt;a href=&#34;https://bioconductor.org/&#34;&gt;Bioconductor&lt;/a&gt;
(for the most part).&lt;/p&gt;
&lt;p&gt;CRAN has the concept of an archived package. That is, the namespace
for a package (&lt;code&gt;foo&lt;/code&gt;) is still in the registry (and can not be used again),
but the package is archived - no longer gets updated and checks
I think are no longer performed.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<blockquote>
<p>Update on 2021-02-09: I&rsquo;ve archived 8 more packages. Post below updated</p>
</blockquote>
<!-- raw HTML omitted -->
<p>Code is often arranged in packages for any given language. Packages
are often cataloged in a package registry of some kind: NPM for
node, crates.io for Rust, etc. For R, that registry is either
<a href="https://cran.r-project.org/">CRAN</a> or <a href="https://bioconductor.org/">Bioconductor</a>
(for the most part).</p>
<p>CRAN has the concept of an archived package. That is, the namespace
for a package (<code>foo</code>) is still in the registry (and can not be used again),
but the package is archived - no longer gets updated and checks
I think are no longer performed.</p>
<p>We rarely hear the stories behind how software gets laid to rest. What are
the most common reasons for software to be abandoned?</p>
<h2 id="my-cran-archived-packages">My CRAN archived packages</h2>
<p>First, my archived CRAN packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(pkgsearch)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(dplyr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(data.table)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tibble)
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#a6e22e">cran_events</span>(releases <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, archivals <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000L</span>)
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(x, <span style="color:#66d9ef">function</span>(w)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tibble</span>(pkg<span style="color:#f92672">=</span>w<span style="color:#f92672">$</span>name, maintainer<span style="color:#f92672">=</span>w<span style="color:#f92672">$</span>package<span style="color:#f92672">$</span>Maintainer))
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> <span style="color:#a6e22e">rbindlist</span>(res, use.names <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> <span style="color:#a6e22e">as_tibble</span>(df)
</span></span><span style="display:flex;"><span>scott <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">filter</span>(df, <span style="color:#a6e22e">grepl</span>(<span style="color:#e6db74">&#34;chamberlain&#34;</span>, maintainer, ignore.case <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">select</span>(pkg) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">data.frame</span>()
</span></span><span style="display:flex;"><span>scott
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;            pkg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1      originr</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2       geoaxe</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3         lawn</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4     pleiades</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5       geoops</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6          rif</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7     rbraries</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 8        ccafs</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 9     rjsonapi</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 10       rdpla</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 11 seaaroundus</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 12    crevents</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 13      etseed</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 14      rtimes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 15   rsunlight</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 16        nneo</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 17     binomen</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 18        solr</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 19      enigma</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 20         alm</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 21    ropensnp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 22      govdat</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 23  spoccutils</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 24     rgauges</span>
</span></span></code></pre></div><p>I have 24 archived packages on CRAN.</p>
<h2 id="stories">Stories</h2>
<p>The following are brief stories of why each package was archived on CRAN.</p>
<ul>
<li><strong>spoccutils</strong>: was a package of utility functions that didn&rsquo;t quite fit within the scope of another package <a href="https://github.com/ropensci/spocc">spocc</a>. It was renamed to <a href="https://github.com/ropensci/mapr">mapr</a>. I suppose I could have asked CRAN to change the name, hmmm</li>
<li><strong><a href="https://github.com/ropensci-archive/rgauges">rgauges</a></strong>: was a client for the <a href="https://get.gaug.es/">Gaug.es</a> website analytics API - we started the package to gather data on visitors to the rOpenSci website. Eventually we stopped using Gaug.es and then it didn&rsquo;t make sense to maintain the package, so it was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/alm">alm</a></strong>: was a client for a generic article-level metrics web service framework called Lagotto. In the early days of rOpenSci we were quite engaged with the community of folks working on article-level metrics. If I remember correctly, Lagotto usage slowed down and wasn&rsquo;t used much so I gave up on maintaining <code>alm</code></li>
<li><strong>ropensnp</strong>: was a client for the service <a href="https://opensnp.org/">OpenSNP</a>. There were other sources of SNP data that I thought would be nice to access all from one package; so a new package (<a href="https://github.com/ropensci/rsnps">rsnps</a>) was created and incorporated functions for OpenSNP and <code>ropensnp</code> was archived.</li>
<li><strong>solr</strong>: was a package client for the <a href="https://lucene.apache.org/solr/">Apache Solr</a> database. At some point it got a major overhual and I decided to change the package name to <a href="https://github.com/ropensci/solrium">solrium</a>.</li>
<li><strong><a href="https://github.com/ropensci/binomen">binomen</a></strong>: aim of the package was functions for creating taxonomic classes/objects and functions for manipulating taxonomic data, sort of like dplyr. Evolution of ideas in <code>binomen</code> gave way to a new package <a href="https://github.com/ropensci/taxa">taxa</a>, now maintained by <a href="https://github.com/zachary-foster">Zach Foster</a>.</li>
<li><strong><a href="https://github.com/ropensci-archive/nneo">nneo</a></strong>: was a client for APIs for <a href="https://data.neonscience.org/data-api/">NEON</a> data. At some point I stumbled upon someone else from NEON making essentially the same package, so I archived mine.</li>
<li><strong><a href="https://github.com/ropensci-archive/etseed">etseed</a></strong>: was a package for interacting with the distributed key-value store <a href="https://etcd.io/">etcd</a>. I was on a kick at the time of making R packages for databases, and saw a missing package I thought. After getting familiar with etcd, I realized I would probably never use it myself, and further, it probably didn&rsquo;t make sense to interact with etcd from R anyway.</li>
<li><strong><a href="https://github.com/ropensci-archive/crevents">crevents</a></strong>: <a href="https://www.crossref.org/">Crossref</a> mints DOIs for scholarly articles (among other works). A neat service they started was collecting and making searchable the &ldquo;events&rdquo; on DOIs - that is, the links pointing to DOIs, e.g., from Twitter, etc. The service at some point became very unreliable (was often down), so the package was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/seaaroundus">seaaroundus</a></strong>: <a href="https://www.seaaroundus.org/">Seaaroundus</a> maintains fisheries and fisheries-related data. I was helping maintain an R package for the API, but it was a difficult one to maintain, and most users simply sent emails requesting dumps of data anyway - so the package was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/rdpla">rdpla</a></strong>: The <a href="https://dp.la/">Digital Public Library of America</a> is a very cool organization that is similar to Crossref in a way, in that they centralize metadata about &ldquo;things&rdquo;; metadata on museum collections for DPLA and scholarly works for Crossref. I figured many researchers would enjoy being able to easily get metadata from DPLA for research on museum collections. In the end not many people used the package.</li>
<li><strong><a href="https://github.com/ropensci-archive/rjsonapi">rjsonapi</a></strong>: <a href="https://jsonapi.org/">JSON:API</a> is a cool idea - a sort of specification for building APIs in JSON. REST APIs are incredibly variable - this is an attempto standardize it a bit. I thought perhaps JSON:API would be adopted widely and that an R client would be useful for consuming JSON:API services - however, I&rsquo;ve seen only very few APIs using JSON:API.</li>
<li><strong><a href="https://github.com/ropensci-archive/originr">originr</a></strong>: The idea with <code>originr</code> originally was to centralize in one package tools for biologists to get data on &ldquo;nativity&rdquo; of species in their studies: are species X and Y native to A, B, and C countries. I was lucky to get a collaborator (<a href="https://github.com/ibartomeus">Ignasi Bartomeus</a>) to help on that package. The package simply was not used much at all, and the data sources used were very flaky, making for a buggy user experience.</li>
<li><strong><a href="https://github.com/ropensci-archive/geoaxe">geoaxe</a></strong>: This package always had a very narrow scope. It was created to solve a problem in two widely used packages: <a href="https://github.com/ropensci/rgbif">rgbif</a> and <a href="https://github.com/ropensci/spocc">spocc</a>. In both of those packages we needed to take user input of a Well-known text (WKT) string representing a polygon in which the user wanted to search for something in a remote data source. And with that WKT we would chop up the polygon into smaller polygons to be submitted in multiple (spatial) requests instead of one very large (spatial) request. I didn&rsquo;t want to depend on the heavy <code>rgdal</code> depenency, so I cooked up <code>geoaxe</code> that only used <code>sp</code> and <code>rgeos</code>. <code>geoaxe</code> lasted for many years, but there&rsquo;s better tools out there now, so it was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/lawn">lawn</a></strong>: This package started out when I was trying to see what we could do in spatial R packages, specifically around GeoJSON. Jeroen had recently created the <a href="https://github.com/jeroen/v8">V8</a> package so you could leverage bundled Javascript libraries in R. <a href="https://turfjs.org/">turf.js</a> was a neat project for Javascript for spatial analysis and built in a modular, approachable manner - I thought. So collaborator <a href="https://github.com/jhollist">Jeff Hollister</a> and I wrapped turf.js in R. It was not used that much - and especially not used much after the rise of sf and related &ldquo;tidy&rdquo; spatial packages, leading to archival.</li>
<li><strong><a href="https://github.com/sckott/geoops">geoops</a></strong>: This package was a follow on from <code>lawn</code>, in exploring more GeoJSON focused work. I wanted to learn how to make an R package mostly out of C++, with just a thin layer of R on top. Like <code>lawn</code>, <code>geoops</code> was not used much at all as far as I could tell, maybe partly because it focused only on GeoJSON - but this was also during the rise of <code>sf</code> and friends. I moved it to my own personal account just as a little C++ in R playground in case I want to brush up on that.</li>
<li><strong><a href="https://github.com/ropensci-archive/pleiades">pleiades</a></strong>: I don&rsquo;t remember how or why this package started. It was a client for Pleiades (<a href="https://pleiades.stoa.org/home">https://pleiades.stoa.org/home</a>), a database of historical geographic information about the ancient world. It was used very, very little as far as I could tell - so was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/rif">rif</a></strong>: This package was started after a some exploration of what R work we (rOpenSci) could do in the neuroscience field. It was a client for the Neuroscience Information Framework (<a href="https://neuinfo.org/">https://neuinfo.org/</a>), a database of neuroscience information. Another package not used - so was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/rbraries">rbraries</a></strong>: This package started because I thought rOpenSci would make use of the metadata around R package downloads/etc. that <a href="https://libraries.io/">https://libraries.io/</a> collected. We never ended up using the data - and no one seemed to use the package - so was archived.</li>
<li><strong><a href="https://github.com/ropensci-archive/ccafs">ccafs</a></strong>: A client for Climate Change, Agriculture, and Food Security (CCAFS) General Circulation Models (GCM) data (<a href="https://www.ccafs-climate.org/">https://www.ccafs-climate.org/</a>). All I could find for motivation for this package was an email with someone where they shared a few links to different sources of climate data - then apparently this package was born shortly thereafter. It wasn&rsquo;t used much at all - so was archived.</li>
</ul>
<p>The following four packages were all R clients for sources of government open data - see the organization <a href="https://github.com/ropengov">rOpenGov</a> for R packages on government data.</p>
<ul>
<li><strong>govdat</strong>: was split into two packages (<code>rsunlight</code> and <code>rtimes</code>) and <code>govdat</code> was archived</li>
<li><strong><a href="https://github.com/rOpenGov/rsunlight">rsunlight</a></strong>: was a client for many APIs of the organization <a href="https://sunlightfoundation.com/api/">Sunlight Labs</a> - part of the reason for archiving this package was the disintegration of Sunlight Labs, which made the previously sensible organization of many APIs into one R package not sensible anymore. Also, government data was considered out of scope for our work at rOpenSci.</li>
<li><strong><a href="https://github.com/rOpenGov/rtimes">rtimes</a></strong>: was a client for a number of the government data APIs from the New York Times. One reason for abandoning this package was that NYT almost never responded to questions/feedback on their APIs. Another reason was the aforementioned focus of rOpenSci.</li>
<li><strong><a href="https://github.com/rOpenGov/enigma">enigma</a></strong>: was a client for the Enigma API - the company I think was first focused on making open government data easier to access - as well as data on companies. I didn&rsquo;t really use the package at all though, and there wasn&rsquo;t much usage of the package, so archived it.</li>
</ul>
<p>As a summary of the lists above, a list of the major reasons each package was archived:</p>
<ul>
<li>Not used
<ul>
<li>rjsonapi</li>
<li>rdpla</li>
<li>etseed</li>
<li>enigma</li>
<li>rgauges</li>
<li>rtimes</li>
<li>originr</li>
<li>geaoxe</li>
<li>pleiades</li>
<li>rif</li>
<li>rbraries</li>
<li>ccafs</li>
</ul>
</li>
<li>The fall of the GeoJSON-verse <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
<ul>
<li>lawn</li>
<li>geoops</li>
</ul>
</li>
<li>Bad/retired service
<ul>
<li>rtimes</li>
<li>seaaroundus</li>
<li>crevents</li>
<li>alm</li>
</ul>
</li>
<li>Name change
<ul>
<li>solr</li>
<li>ropensnp</li>
<li>spoccutils</li>
</ul>
</li>
<li>Evolution to new package
<ul>
<li>binomen</li>
<li>govdat</li>
</ul>
</li>
<li>Duplicated work
<ul>
<li>nneo</li>
</ul>
</li>
<li>Out of scope
<ul>
<li>rsunlight</li>
</ul>
</li>
</ul>
<p>Footnotes:</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>although, <code>geojsonsf</code> is very successful so I think my projects were just crap I guess :)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>taxizedb: an update</title>
      <link>http://localhost:1313/2020/08/taxizedb-update/</link>
      <pubDate>Mon, 17 Aug 2020 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2020/08/taxizedb-update/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;https://github.com/ropensci/taxizedb&#34;&gt;taxizedb&lt;/a&gt; arose from pain in using &lt;a href=&#34;https://github.com/ropensci/taxize&#34;&gt;taxize&lt;/a&gt; when dealing with large amounts of data in a single request or doing a lot of requests of any data size. &lt;a href=&#34;https://github.com/ropensci/taxize&#34;&gt;taxize&lt;/a&gt; works with remote data sources on the web, so there&amp;rsquo;s a number of issues that can slow the response down: internet speed, server response speed (was a response already cached or not; or do they even use caching), etc.&lt;/p&gt;
&lt;p&gt;The idea with &lt;a href=&#34;https://github.com/ropensci/taxizedb&#34;&gt;taxizedb&lt;/a&gt; was to allow users to do the same things as taxize allows, but much faster by accessing the entire database for a data source on their own computer. The previous versions of taxizedb used a variety of different databases (MySQL/MariaDB, PostgreSQL, SQLite), so the technical barrier to entry was pretty high. In the newest version just released, we&amp;rsquo;ve drastically simplified the database situation, among other things.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p><a href="https://github.com/ropensci/taxizedb">taxizedb</a> arose from pain in using <a href="https://github.com/ropensci/taxize">taxize</a> when dealing with large amounts of data in a single request or doing a lot of requests of any data size. <a href="https://github.com/ropensci/taxize">taxize</a> works with remote data sources on the web, so there&rsquo;s a number of issues that can slow the response down: internet speed, server response speed (was a response already cached or not; or do they even use caching), etc.</p>
<p>The idea with <a href="https://github.com/ropensci/taxizedb">taxizedb</a> was to allow users to do the same things as taxize allows, but much faster by accessing the entire database for a data source on their own computer. The previous versions of taxizedb used a variety of different databases (MySQL/MariaDB, PostgreSQL, SQLite), so the technical barrier to entry was pretty high. In the newest version just released, we&rsquo;ve drastically simplified the database situation, among other things.</p>
<p><a href="https://github.com/ropensci/taxadb">taxadb</a> was developed as an alternative approach to taxizedb and should also be considered when dealing with taxonomic names. It takes a different approach for the data, with tabular files hosted on GitHub releases, but is similar in that after downloading the data is put into a SQL database, SQLite by default (with other options for databases). taxadb user facing functions are different from those in taxizedb, and largely don&rsquo;t overlap.</p>
<p>taxizedb quick links:</p>
<ul>
<li><a href="https://github.com/ropensci/taxizedb">taxizedb repo</a></li>
<li><a href="https://cloud.r-project.org/web/packages/taxizedb/">taxizedb on cran</a></li>
<li><a href="https://ropensci.github.io/taxizedb/">taxizedb docs</a></li>
</ul>
<p>Install the latest version, if you don&rsquo;t get <code>v0.2.0</code> with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;taxizedb&#34;</span>)
</span></span></code></pre></div><p>then use</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;taxizedb&#34;</span>, repos <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://dev.ropensci.org&#34;</span>)
</span></span></code></pre></div><p>Load the package</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(taxizedb)
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="all-sqlite">All SQLite!</h2>
<p>SQLite is shipped in nearly every device these days, so taxizedb now uses only SQLite for the database backend for each data source. Every person that installs taxizedb should have SQLite already installed. In addition, there&rsquo;s no usernames/passwords/ports to setup with. How we&rsquo;ve accomplished this is partly through automation:</p>
<ul>
<li>NCBI: SQLite built within R from tabular files</li>
<li>ITIS: they provide a SQLite dump</li>
<li>Plantlist: is no longer updated; we build a SQLite manually from csv files</li>
<li>COL: a SQLite is built once a day via GitHub Actions</li>
<li>GBIF: a SQLite is built once a day via GitHub Actions</li>
<li>Wikidata: SQLite built within R from a tabular file</li>
<li>World Flora Online: SQLite built within R from a tabular file</li>
</ul>
<p>Some of the databases have indices to speed up queries, making them a bit larger relative to no indices, but these days most people likely are willing to use up a little more disk space on their computer to have faster queries.</p>
<!-- raw HTML omitted -->
<h2 id="new-data-sources">New data sources</h2>
<p>Three new data sources were added:</p>
<ul>
<li><a href="https://www.ncbi.nlm.nih.gov/taxonomy">NCBI taxonomy</a> - all of this work was done by <a href="https://github.com/arendsee">Zebulun Arendsee</a></li>
<li><a href="https://www.worldfloraonline.org/">World Flora Online</a> - the replacement for The Plant List</li>
<li><a href="https://zenodo.org/record/1213477">Wikidata</a> - the table <code>wikidata-taxon-info</code>, extracted taxon objects from Wikidata, last updated April 2018, on Zenodo</li>
</ul>
<!-- raw HTML omitted -->
<h2 id="new-functions-taxize-equivalents">New functions: taxize equivalents</h2>
<p>Three new high level functions matching those in taxize were added: <code>children</code>, <code>classification</code>, <code>downstream</code>. The taxize version of those functions are still good for smaller requests, but with larger requests, its probably best to use taxizedb. The most common problem where taxize becomes frustrating is with <code>downstream</code> where a user wants all species within a high taxonomic rank like phylum. The original work for these functions was done by <a href="https://github.com/arendsee">Zebulun Arendsee</a>.</p>
<p>Here&rsquo;s a comparison of taxize vs. taxizedb with <code>downstream</code> - getting all species within the genus <em>Bombus</em> (bumble bees)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>id_tx <span style="color:#f92672">&lt;-</span> taxize<span style="color:#f92672">::</span><span style="color:#a6e22e">get_tsn</span>(<span style="color:#e6db74">&#34;Bombus&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">system.time</span>(taxize<span style="color:#f92672">::</span><span style="color:#a6e22e">downstream</span>(id_tx, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;itis&#34;</span>, downto <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;species&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;    user  system elapsed </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   2.144   0.130  20.533</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>id_txdb <span style="color:#f92672">&lt;-</span> taxizedb<span style="color:#f92672">::</span><span style="color:#a6e22e">name2taxid</span>(<span style="color:#e6db74">&#39;Bombus&#39;</span>, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;itis&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">system.time</span>(taxizedb<span style="color:#f92672">::</span><span style="color:#a6e22e">downstream</span>(id_txdb, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;itis&#34;</span>, downto <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;species&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;    user  system elapsed </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   0.132   0.051   0.186</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<p>In addition, three new &ldquo;mapping&rdquo; functions were added that are similar to those in taxize, but with different names: <code>name2taxid</code> (scientific or common name to taxonomy ID); <code>taxid2name</code> (taxonomy ID to scientific name); <code>taxid2rank</code> (taxonomy ID to rank).</p>
<p>We saw <code>name2taxid</code> above. Below we get the taxonomic ID for COL, ITIS and GBIF for <em>Bombus</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">name2taxid</span>(<span style="color:#e6db74">&#39;Bombus&#39;</span>, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;col&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;3993765&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name2taxid</span>(<span style="color:#e6db74">&#39;Bombus&#39;</span>, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;itis&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;154397&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">name2taxid</span>(<span style="color:#e6db74">&#39;Bombus&#39;</span>, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gbif&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1340278&#34;</span>
</span></span></code></pre></div><p>Get the scientific name from a taxonomic ID</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">taxid2name</span>(<span style="color:#ae81ff">3993765</span>, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;col&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Bombus&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">taxid2rank</span>(<span style="color:#ae81ff">3993765</span>, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;col&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;genus&#34;</span>
</span></span></code></pre></div><p>These functions are quite fast too:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>x <span style="color:#f92672">&lt;-</span> taxize<span style="color:#f92672">::</span><span style="color:#a6e22e">names_list</span>(rank <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;species&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000L</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">system.time</span>(<span style="color:#a6e22e">name2taxid</span>(x, db <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gbif&#34;</span>, out_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;summary&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;    user  system elapsed </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   0.096   0.206   1.053</span>
</span></span></code></pre></div><!-- raw HTML omitted -->
<h2 id="thoughts">Thoughts?</h2>
<p>Get in touch if you have any feedback at <a href="https://github.com/ropensci/taxizedb/issues">https://github.com/ropensci/taxizedb/issues</a></p>
]]></content:encoded>
    </item>
    <item>
      <title>Faster solr with csv</title>
      <link>http://localhost:1313/2015/03/faster-solr/</link>
      <pubDate>Fri, 20 Mar 2015 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2015/03/faster-solr/</guid>
      <description>&lt;p&gt;With the &lt;a href=&#34;https://github.com/ropensci/solr/issues/47&#34;&gt;help of user input&lt;/a&gt;, I&amp;rsquo;ve tweaked &lt;code&gt;solr&lt;/code&gt; just a bit to make things faster using default setings. I imagine the main interface for people using the &lt;code&gt;solr&lt;/code&gt; R client is via &lt;code&gt;solr_search()&lt;/code&gt;, which used to have &lt;code&gt;wt=json&lt;/code&gt; by default. Changing this to &lt;code&gt;wt=csv&lt;/code&gt; gives better performance. And it sorta makes sense to use csv, as the point of using an R client is probably do get data eventually into a data.frame, so it makes sense to go csv format (Already in tabular format) if it&amp;rsquo;s faster too.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>With the <a href="https://github.com/ropensci/solr/issues/47">help of user input</a>, I&rsquo;ve tweaked <code>solr</code> just a bit to make things faster using default setings. I imagine the main interface for people using the <code>solr</code> R client is via <code>solr_search()</code>, which used to have <code>wt=json</code> by default. Changing this to <code>wt=csv</code> gives better performance. And it sorta makes sense to use csv, as the point of using an R client is probably do get data eventually into a data.frame, so it makes sense to go csv format (Already in tabular format) if it&rsquo;s faster too.</p>
<h2 id="install">Install</h2>
<p>Install and load <code>solr</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;ropensci/solr&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;solr&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;microbenchmark&#34;</span>)
</span></span></code></pre></div><h2 id="setup">Setup</h2>
<p>Define base url and fields to return</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>url <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;https://api.plos.org/search&#39;</span>
</span></span><span style="display:flex;"><span>fields <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#39;id&#39;</span>,<span style="color:#e6db74">&#39;cross_published_journal_name&#39;</span>,<span style="color:#e6db74">&#39;cross_published_journal_key&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;cross_published_journal_eissn&#39;</span>,<span style="color:#e6db74">&#39;pmid&#39;</span>,<span style="color:#e6db74">&#39;pmcid&#39;</span>,<span style="color:#e6db74">&#39;publisher&#39;</span>,<span style="color:#e6db74">&#39;journal&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;publication_date&#39;</span>,<span style="color:#e6db74">&#39;article_type&#39;</span>,<span style="color:#e6db74">&#39;article_type_facet&#39;</span>,<span style="color:#e6db74">&#39;author&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;author_facet&#39;</span>,<span style="color:#e6db74">&#39;volume&#39;</span>,<span style="color:#e6db74">&#39;issue&#39;</span>,<span style="color:#e6db74">&#39;elocation_id&#39;</span>,<span style="color:#e6db74">&#39;author_display&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;competing_interest&#39;</span>,<span style="color:#e6db74">&#39;copyright&#39;</span>)
</span></span></code></pre></div><h2 id="json">json</h2>
<p>The previous default for <code>solr_search()</code> used <code>json</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;json&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Source: local data frame [10 x 19]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                    id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1             10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2       10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3    10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/abstract</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4  10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/references</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5        10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/body</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6             10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7       10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 8    10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/abstract</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 9  10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/references</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 10       10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/body</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Variables not shown: cross_published_journal_name (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   cross_published_journal_key (chr), cross_published_journal_eissn (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   pmid (chr), pmcid (chr), publisher (chr), journal (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   publication_date (chr), article_type (chr), article_type_facet (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   author (chr), author_facet (chr), volume (int), issue (int),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   elocation_id (chr), author_display (chr), competing_interest (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   copyright (chr)</span>
</span></span></code></pre></div><h2 id="csv">csv</h2>
<p>The default <code>wt</code> setting is now <code>csv</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;json&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Source: local data frame [10 x 19]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                    id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1             10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2       10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3    10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/abstract</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4  10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/references</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5        10.1371/annotation/856f0890-9d85-4719-8e54-c27530ac94f4/body</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6             10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7       10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 8    10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/abstract</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 9  10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/references</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 10       10.1371/annotation/8551e3d5-fdd5-413b-a253-170ba13b7525/body</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Variables not shown: cross_published_journal_name (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   cross_published_journal_key (chr), cross_published_journal_eissn (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   pmid (chr), pmcid (chr), publisher (chr), journal (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   publication_date (chr), article_type (chr), article_type_facet (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   author (chr), author_facet (chr), volume (int), issue (int),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   elocation_id (chr), author_display (chr), competing_interest (chr),</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   copyright (chr)</span>
</span></span></code></pre></div><h2 id="compare-times">Compare times</h2>
<p>When parsing to a data.frame (which <code>solr_search()</code> does by default), csv is quite a bit faster.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">microbenchmark</span>(
</span></span><span style="display:flex;"><span>  json <span style="color:#f92672">=</span> <span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;json&#34;</span>, verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>),
</span></span><span style="display:flex;"><span>  csv <span style="color:#f92672">=</span> <span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;csv&#34;</span>, verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>), 
</span></span><span style="display:flex;"><span>  times <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Unit: milliseconds</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  expr      min       lq      mean    median        uq       max neval cld</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  json 965.7043 1013.014 1124.1229 1086.3225 1227.9054 1441.8332    20   b</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   csv 509.6573  520.089  541.5784  532.4546  548.0303  723.7575    20  a</span>
</span></span></code></pre></div><h2 id="json-vs-xml-vs-csv">json vs xml vs csv</h2>
<p>When getting raw data, csv is best, json next, then xml pulling up the rear.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">microbenchmark</span>(
</span></span><span style="display:flex;"><span>  json <span style="color:#f92672">=</span> <span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;json&#34;</span>, verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, raw <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
</span></span><span style="display:flex;"><span>  csv <span style="color:#f92672">=</span> <span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;csv&#34;</span>, verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, raw <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
</span></span><span style="display:flex;"><span>  xml <span style="color:#f92672">=</span> <span style="color:#a6e22e">solr_search</span>(q<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*:*&#39;</span>, rows<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>, fl<span style="color:#f92672">=</span>fields, base<span style="color:#f92672">=</span>url, wt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xml&#34;</span>, verbose <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, raw <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
</span></span><span style="display:flex;"><span>  times <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Unit: milliseconds</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  expr       min       lq      mean    median        uq       max neval cld</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  json 1110.9515 1142.478 1198.9981 1169.0808 1195.5709 1518.7412    10  b </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   csv  801.6871  802.516  826.0655  819.1532  835.0512  873.4266    10 a  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   xml 1507.1111 1554.002 1618.5963 1617.5208 1671.0026 1740.4448    10   c</span>
</span></span></code></pre></div><h2 id="notes">Notes</h2>
<p>Note that <code>wt=csv</code> is only available in <code>solr_search()</code> and <code>solr_all()</code> because csv writer
only returns the docs element in csv, dropping other elements, including facets, mlt, groups,
stats, etc.</p>
<p>Also, note the http client used in <code>solr</code> is <code>httr</code>, which passes in a gzip compression header by default, so as long as the server serving up the Solr data has compression turned on, that&rsquo;s all set.</p>
<p>Another way I&rsquo;ve sped things up is if you use <code>wt=json</code> then parse to a data.frame, it uses <code>dplyr</code> which sped things up considerably.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Intro to alpha ckanr - R client for CKAN RESTful API</title>
      <link>http://localhost:1313/2014/11/ckanr-intro/</link>
      <pubDate>Wed, 26 Nov 2014 11:42:36 +0000</pubDate>
      <guid>http://localhost:1313/2014/11/ckanr-intro/</guid>
      <description>&lt;p&gt;Recently I had need to create a client for scraping museum metadata to help out some folks that use that kind of data. It&amp;rsquo;s called &lt;a href=&#34;https://github.com/ropensci/musemeta&#34;&gt;musemeta&lt;/a&gt;. One of the data sources in that package uses the open source &lt;em&gt;data portal software&lt;/em&gt; &lt;a href=&#34;https://ckan.org/&#34;&gt;CKAN&lt;/a&gt;, and so we can interact with &lt;a href=&#34;https://docs.ckan.org/en/latest/api/index.html&#34;&gt;the CKAN API&lt;/a&gt; to get data. Since many groups can use CKAN API/etc infrastucture because it&amp;rsquo;s open source, I thought why not have a general purpose R client for this, since &lt;a href=&#34;https://github.com/ckan/ckan/wiki/CKAN-API-Clients&#34;&gt;there are other clients&lt;/a&gt; for Python, PHP, Ruby, etc.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>Recently I had need to create a client for scraping museum metadata to help out some folks that use that kind of data. It&rsquo;s called <a href="https://github.com/ropensci/musemeta">musemeta</a>. One of the data sources in that package uses the open source <em>data portal software</em> <a href="https://ckan.org/">CKAN</a>, and so we can interact with <a href="https://docs.ckan.org/en/latest/api/index.html">the CKAN API</a> to get data. Since many groups can use CKAN API/etc infrastucture because it&rsquo;s open source, I thought why not have a general purpose R client for this, since <a href="https://github.com/ckan/ckan/wiki/CKAN-API-Clients">there are other clients</a> for Python, PHP, Ruby, etc.</p>
<p>Here&rsquo;s a bit of an intro:</p>
<h2 id="setup">Setup</h2>
<p>Get/load packages</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;devtools&#34;</span>)
</span></span><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;ropensci/ckanr&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;ckanr&#34;</span>)
</span></span></code></pre></div><blockquote>
<p>Note: the default URL is for <a href="https://data.techno-science.ca/">https://data.techno-science.ca/</a>. You can change that in the <code>url</code> parameter</p>
</blockquote>
<h2 id="some-package-details">Some package details</h2>
<p>All API alls are <code>POST</code> requests, and handled through a helper function called <code>ckan_POST()</code>. See <code>ckanr:::ckan_POST</code> to see the function.</p>
<p>There are some common parameters across most functions that are worth describing a bit:</p>
<ul>
<li><code>offset</code> (numeric) Where to start getting items from (optional, default: 0)</li>
<li><code>limit</code> (numeric) The maximum number of items to return (optional, default: 31)</li>
<li><code>url</code> Base url to use. Default: <a href="https://data.techno-science.ca">https://data.techno-science.ca</a></li>
<li><code>as</code> (character) One of <code>list</code> (default), <code>table</code>, or <code>json</code>. Parsing with table option uses <code>jsonlite::fromJSON(..., simplifyDataFrame = TRUE)</code>, which attempts to parse data to <code>data.frame</code>&rsquo;s when possible, so the result can vary.</li>
<li><code>...</code> Curl args passed on to <code>httr::POST</code></li>
</ul>
<h2 id="changes">Changes</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">changes</span>(limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, as <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;table&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                user_id                  timestamp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 b50449ea-1dcc-4d52-b620-fc95bf56034b 2014-11-06T18:58:08.001743</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 b50449ea-1dcc-4d52-b620-fc95bf56034b 2014-11-06T18:55:55.059527</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                              object_id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 cc6a523c-cecf-4a95-836b-295a11ce2bce</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 cc6a523c-cecf-4a95-836b-295a11ce2bce</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                            revision_id data.package.maintainer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 5d11079e-fc05-4121-9fd5-fe086f5e5f33                        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 4a591538-0584-487b-8ed1-3260d1d09d77                        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   data.package.name data.package.metadata_modified data.package.author</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1              test     2014-11-06T18:55:54.772675                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2              test     2014-11-06T18:55:54.772675                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   data.package.url data.package.notes               data.package.owner_org</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                                     fafa260d-e2bf-46cd-9c35-34c1dfa46c57</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                                     fafa260d-e2bf-46cd-9c35-34c1dfa46c57</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   data.package.private data.package.maintainer_email</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                FALSE                              </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                FALSE                              </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   data.package.author_email data.package.state data.package.version</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                                      deleted                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                                       active                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;           data.package.creator_user_id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 b50449ea-1dcc-4d52-b620-fc95bf56034b</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 b50449ea-1dcc-4d52-b620-fc95bf56034b</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                        data.package.id data.package.title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 cc6a523c-cecf-4a95-836b-295a11ce2bce               test</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 cc6a523c-cecf-4a95-836b-295a11ce2bce               test</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;               data.package.revision_id data.package.type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 5d11079e-fc05-4121-9fd5-fe086f5e5f33           dataset</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 4a591538-0584-487b-8ed1-3260d1d09d77           dataset</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   data.package.license_id                                   id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1            notspecified 59c308c8-68b2-4b92-bc57-129378d31882</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2            notspecified a8577e2c-f742-49c2-bef3-ca3299e58704</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;     activity_type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 deleted package</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 changed package</span>
</span></span></code></pre></div><h2 id="list-datasets">List datasets</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">datasets</span>(as <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;table&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [1] &#34;artifact-data-agriculture&#34;                                  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [2] &#34;artifact-data-aviation&#34;                                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [3] &#34;artifact-data-bookbinding&#34;                                  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [4] &#34;artifact-data-chemistry&#34;                                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [5] &#34;artifact-data-communications&#34;                               </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [6] &#34;artifact-data-computing-technology&#34;                         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [7] &#34;artifact-data-domestic-technology&#34;                          </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [8] &#34;artifact-data-energy-electric&#34;                              </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [9] &#34;artifact-data-exploration-and-survey&#34;                       </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [10] &#34;artifact-data-fisheries&#34;                                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [11] &#34;artifact-data-forestry&#34;                                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [12] &#34;artifact-data-horology&#34;                                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [13] &#34;artifact-data-industrial-technology&#34;                        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [14] &#34;artifact-data-lighting-technology&#34;                          </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [15] &#34;artifact-data-location-canada-agriculture-and-food-museum&#34;  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [16] &#34;artifact-data-location-canada-aviation-and-space-museum&#34;    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [17] &#34;artifact-data-location-canada-science-and-technology-museum&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [18] &#34;artifact-data-marine-transportation&#34;                        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [19] &#34;artifact-data-mathematics&#34;                                  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [20] &#34;artifact-data-medical-technology&#34;                           </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [21] &#34;artifact-data-meteorology&#34;                                  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [22] &#34;artifact-data-metrology&#34;                                    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [23] &#34;artifact-data-mining-and-metallurgy&#34;                        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [24] &#34;artifact-data-motorized-ground-transportation&#34;              </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [25] &#34;artifact-data-non-motorized-ground-transportation&#34;          </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [26] &#34;artifact-data-on-loan&#34;                                      </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [27] &#34;artifact-data-photography&#34;                                  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [28] &#34;artifact-data-physics&#34;                                      </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [29] &#34;artifact-data-printing&#34;                                     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [30] &#34;artifact-data-railway-transportation&#34;                       </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [31] &#34;artifact-dataset-fire-fighting&#34;</span>
</span></span></code></pre></div><h2 id="list-tags">List tags</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">tag_list</span>(<span style="color:#e6db74">&#39;aviation&#39;</span>, as<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   vocabulary_id                     display_name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1            NA                         Aviation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2            NA Canada Aviation and Space Museum</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                     id                             name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 cc1db2db-b08b-4888-897f-a17eade2461b                         Aviation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 8d05a650-bc7b-4b89-bcc8-c10177e60119 Canada Aviation and Space Museum</span>
</span></span></code></pre></div><h2 id="show-tags">Show tags</h2>
<p>Subset for readme brevity</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">tag_show</span>(<span style="color:#e6db74">&#39;Aviation&#39;</span>)<span style="color:#f92672">$</span>packages[[1]][1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>]  
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $owner_org</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;fafa260d-e2bf-46cd-9c35-34c1dfa46c57&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $maintainer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $relationships_as_object</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; list()</span>
</span></span></code></pre></div><h2 id="list-groups">List groups</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">group_list</span>(as<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                         display_name description</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                     Communications            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Domestic and Industrial Technology            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                         Everything            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4                           Location            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5                          Resources            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6         Scientific Instrumentation            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7                     Transportation            </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                     Communications</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Domestic and Industrial Technology</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                         Everything</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4                           Location</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5                          Resources</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6         Scientific Instrumentation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7                     Transportation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                   image_display_url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1       http://data.techno-science.ca/uploads/group/20141024-162305.6896412comm.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2    http://data.techno-science.ca/uploads/group/20141024-162324.3636615domtech.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 http://data.techno-science.ca/uploads/group/20141024-162448.0656596everything.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4   http://data.techno-science.ca/uploads/group/20141024-162528.8786547location.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5     http://data.techno-science.ca/uploads/group/20141024-162608.3732604resour.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6    http://data.techno-science.ca/uploads/group/20141024-162549.1925831sciinst.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7  http://data.techno-science.ca/uploads/group/20141024-162624.1872823transport.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   approval_status is_organization  state</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7        approved           FALSE active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                               image_url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1       20141024-162305.6896412comm.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2    20141024-162324.3636615domtech.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 20141024-162448.0656596everything.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4   20141024-162528.8786547location.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5     20141024-162608.3732604resour.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6    20141024-162549.1925831sciinst.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7  20141024-162624.1872823transport.jpg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                            revision_id packages  type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 cc302424-2e68-4fcc-9a3a-6de60748c2e4        5 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 b7d95b87-5999-45f9-8775-c64094842551        2 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 c2f0c59a-a543-4d67-a61f-4f387068ba53        1 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4 6816d571-d2bd-4131-b99d-80e7e6797492        4 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5 e37ee30d-577b-4349-8f0e-eaa4543497e8        6 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6 74eba42e-08b3-4400-b40f-3d6159ae6e9d       10 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7 a6cc4aab-eae9-42ba-9ab4-cbf45d5c6a0e        7 group</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                     id                               name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 5268ce18-e3b8-4802-b29e-30740b46e52d                     communications</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 5a9a8095-9e0c-485e-84f6-77f577607991 domestic-and-industrial-technology</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 d7dd233e-a1cc-43da-8152-f7ed15d26756                         everything</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4 770fc9c0-d4f3-48b0-a4ee-e00c6882df1d                           location</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 5 f6c205de-cc95-4308-ac9f-5a63f1a5c7ee                          resources</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 6 b98ff457-2031-48b6-b681-9adb3afc501b         scientific-instrumentation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 7 a73bf7be-310d-472e-83e1-43a3d87602ba                     transportation</span>
</span></span></code></pre></div><h2 id="show-groups">Show groups</h2>
<p>Subset for readme brevity</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">group_show</span>(<span style="color:#e6db74">&#39;communications&#39;</span>, as<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;table&#39;</span>)<span style="color:#f92672">$</span>users
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   openid about capacity     name                    created</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1     NA  &lt;NA&gt;    admin     marc 2014-10-24T14:44:29.885262</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2     NA          admin sepandar 2014-10-23T19:40:42.056418</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                         email_hash sysadmin</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 a32002c960476614370a16e9fb81f436    FALSE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 10b930a228afd1da2647d62e70b71bf8     TRUE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   activity_streams_email_notifications  state number_of_edits</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                                FALSE active             376</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                                FALSE active              44</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   number_administered_packages display_name fullname</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                           39         marc     &lt;NA&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                            1     sepandar         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                     id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 27778230-2e90-4818-9f00-bbf778c8fa09</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 b50449ea-1dcc-4d52-b620-fc95bf56034b</span>
</span></span></code></pre></div><h2 id="show-a-package">Show a package</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">package_show</span>(<span style="color:#e6db74">&#39;34d60b13-1fd5-430e-b0ec-c8bc7f4841cf&#39;</span>, as<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;table&#39;</span>)<span style="color:#f92672">$</span>resources
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                      resource_group_id cache_last_updated</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 ea8533d9-cdc6-4e0e-97b9-894e06d50b92                 NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 ea8533d9-cdc6-4e0e-97b9-894e06d50b92                 NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 ea8533d9-cdc6-4e0e-97b9-894e06d50b92                 NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4 ea8533d9-cdc6-4e0e-97b9-894e06d50b92                 NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;           revision_timestamp webstore_last_updated</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 2014-10-28T18:13:22.213530                    NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 2014-11-04T02:59:50.567068                    NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 2014-11-05T21:23:58.533397                    NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4 2014-11-05T21:25:16.848423                    NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                     id size  state hash</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 be2b0af8-24a8-4a55-8b30-89f5459b713a   NA active     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 7d65910e-4bdc-4f06-a213-e24e36762767   NA active     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 97622ad7-1507-4f6a-8acb-14e826447389   NA active     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4 7a72498a-c49c-4e84-8b10-58991de10df6   NA active     </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                    description format</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                                  XML Dataset    XML</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Data dictionary for CSTMC artifact datasets.    XLS</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3       Tips for using the artifacts datasets.   .php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4       Tips for using the artifacts datasets.   .php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   tracking_summary.total tracking_summary.recent mimetype_inner url_type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                      0                       0             NA       NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                      0                       0             NA       NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                      0                       0             NA       NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4                      0                       0             NA       NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   mimetype cache_url                               name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1       NA        NA Artifact Data - Vacuum Tubes (XML)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2       NA        NA                    Data Dictionary</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3       NA        NA                     Tips (English)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4       NA        NA                      Tips (French)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                      created</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 2014-10-28T18:13:22.240393</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 2014-11-04T02:59:50.643658</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3 2014-11-04T18:14:23.952937</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4 2014-11-05T21:25:16.887796</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                                                                                    url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                         http://source.techno-science.ca/datasets-donn%C3%A9es/artifacts-artefacts/groups-groupes/vacuum-tubes-tubes-electronique.xml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 http://source.techno-science.ca/datasets-donn%C3%A9es/artifacts-artefacts/cstmc-artifact-data-dictionary-dictionnaire-de-donnees-artefacts-smstc.xls</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3                                                                          http://techno-science.ca/en/open-data/tips-using-artifact-open-data-set.php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4                                                                 http://techno-science.ca/fr/donnees-ouvertes/conseils-donnees-ouvertes-artefacts.php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   webstore_url last_modified position                          revision_id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1           NA            NA        0 9a27d884-f181-4842-ab47-cda35a8bf99a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2           NA            NA        1 5d27b3e6-7870-4c12-a122-9e9f5adee4a0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3           NA            NA        2 40993f16-402b-439c-9288-2f2b177e4b8f</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4           NA            NA        3 57f1488e-a140-4eb6-9329-fc13202a73af</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   resource_type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1            NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2            NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 3            NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 4            NA</span>
</span></span></code></pre></div><h2 id="search-for-packages">Search for packages</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">package_search</span>(q <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;*:*&#39;</span>, rows <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, as<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;table&#34;</span>)<span style="color:#f92672">$</span>results
</span></span><span style="display:flex;"><span>out[, <span style="color:#f92672">!</span><span style="color:#a6e22e">names</span>(out) <span style="color:#f92672">%in%</span> <span style="color:#e6db74">&#39;resources&#39;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                      license_title maintainer relationships_as_object</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Open Government Licence - Canada                               NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Open Government Licence - Canada                               NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   private maintainer_email         revision_timestamp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1   FALSE                  2014-11-05T23:17:46.220002</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2   FALSE                  2014-11-05T23:17:04.923594</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                     id           metadata_created</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 35d5484d-38ce-495e-8722-7857c4fd17bf 2014-10-28T20:13:11.572558</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 da65507d-b018-4d3b-bde3-5419cf29d144 2014-10-28T14:59:21.386177</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;            metadata_modified author author_email  state version</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 2014-11-05T23:17:46.220657                     active        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 2014-11-05T23:17:04.924229                     active        </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                        creator_user_id    type num_resources</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 27778230-2e90-4818-9f00-bbf778c8fa09 dataset             4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 27778230-2e90-4818-9f00-bbf778c8fa09 dataset             4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                                                       tags</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                         NA, Location, Location, 2014-10-28T20:13:11.572558, active, da88c5a2-3766-41ea-a75b-9c87047cc528</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 NA, Computing Technology, Computing Technology, 2014-10-28T14:59:21.386177, active, 5371dc28-9ce8-4f21-9afb-1f155f132bfe</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   tracking_summary.total tracking_summary.recent</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                     35                      10</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                     24                       8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                                                                                                                                       groups</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                                                      Location, , http://data.techno-science.ca/uploads/group/20141024-162528.8786547location.jpg, Location, 770fc9c0-d4f3-48b0-a4ee-e00c6882df1d, location</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 Scientific Instrumentation, , http://data.techno-science.ca/uploads/group/20141024-162549.1925831sciinst.jpg, Scientific Instrumentation, b98ff457-2031-48b6-b681-9adb3afc501b, scientific-instrumentation</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   license_id relationships_as_subject num_tags organization.description</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 ca-ogl-lgo                     NULL        1                         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 ca-ogl-lgo                     NULL        1                         </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;         organization.created organization.title organization.name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 2014-10-24T14:49:36.878579              CSTMC             cstmc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 2014-10-24T14:49:36.878579              CSTMC             cstmc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   organization.revision_timestamp organization.is_organization</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1      2014-10-24T14:49:36.813670                         TRUE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2      2014-10-24T14:49:36.813670                         TRUE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   organization.state organization.image_url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1             active                       </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2             active                       </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;               organization.revision_id organization.type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 7a325a56-46f1-419c-b7b2-ec7501edb35a      organization</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 7a325a56-46f1-419c-b7b2-ec7501edb35a      organization</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                        organization.id organization.approval_status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 fafa260d-e2bf-46cd-9c35-34c1dfa46c57                     approved</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 fafa260d-e2bf-46cd-9c35-34c1dfa46c57                     approved</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                          name isopen url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 artifact-data-location-canada-science-and-technology-museum  FALSE    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                          artifact-data-computing-technology  FALSE    </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                                                                                                        notes</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 This dataset includes artifacts in the collection of the Canada Science and Technology Museums Corporation that are currently in the Canada Science and Technology Museum.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                                This dataset includes artifacts in the collection of the Canada Science and Technology Museums Corporation related to computing technology.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                              owner_org extras</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 fafa260d-e2bf-46cd-9c35-34c1dfa46c57   NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 fafa260d-e2bf-46cd-9c35-34c1dfa46c57   NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                            license_url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 http://data.gc.ca/eng/open-government-licence-canada</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 http://data.gc.ca/eng/open-government-licence-canada</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                             title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Artifact Data - Location - Canada Science and Technology Museum</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                            Artifact Data - Computing Technology</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                            revision_id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 694a977a-c238-47a4-8671-caddca4edfca</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 858cb240-76a0-406a-800c-e4ae6cc56ab9</span>
</span></span></code></pre></div><h2 id="search-for-resources">Search for resources</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">resource_search</span>(q <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;name:data&#39;</span>, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, as<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;table&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $count</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 71</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $results</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                      resource_group_id cache_last_updated</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 01a82e52-01bf-4a9c-9b45-c4f9b92529fa                 NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 01a82e52-01bf-4a9c-9b45-c4f9b92529fa                 NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   webstore_last_updated                                   id size  state</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                    NA e179e910-27fb-44f4-a627-99822af49ffa   NA active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                    NA ba84e8b7-b388-4d2a-873a-7b107eb7f135   NA active</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   last_modified hash                                  description format</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1            NA                                       XML Dataset    XML</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2            NA      Data dictionary for CSTMC artifact datasets.    XLS</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   mimetype_inner url_type mimetype cache_url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1             NA       NA       NA        NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2             NA       NA       NA        NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                           name                    created</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 Artifact Data - Exploration and Survey (XML) 2014-10-28T15:50:35.374303</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2                              Data Dictionary 2014-11-03T18:01:02.094210</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                                                                                                                                    url</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1              http://source.techno-science.ca/datasets-donn%C3%A9es/artifacts-artefacts/groups-groupes/exploration-and-survey-exploration-et-leve.xml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 http://source.techno-science.ca/datasets-donn%C3%A9es/artifacts-artefacts/cstmc-artifact-data-dictionary-dictionnaire-de-donnees-artefacts-smstc.xls</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;   webstore_url position                          revision_id resource_type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1           NA        0 a22e6741-3e89-4db0-a802-ba594b1c1fad            NA</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2           NA        1 da1f8585-521d-47ef-8ead-7832474a3421            NA</span>
</span></span></code></pre></div><h2 id="future-work">Future work</h2>
<ul>
<li>There&rsquo;s already <a href="https://github.com/ropensci/ckanr/issues/4">an issue</a> to add support for <a href="http://docs.ckan.org/en/latest/maintaining/datastore.html">DataStore</a></li>
<li>This client needs to be tested against many other CKAN API instances to make sure it&rsquo;s robust</li>
<li>Add a test suite</li>
<li>Use cases: would be nice to include in the package documentation use cases</li>
<li>Other things? Get in touch on twitter <code>@recology_</code> or below</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>sofa - reboot</title>
      <link>http://localhost:1313/2014/11/sofa/</link>
      <pubDate>Tue, 18 Nov 2014 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2014/11/sofa/</guid>
      <description>&lt;p&gt;I&amp;rsquo;ve reworked &lt;code&gt;sofa&lt;/code&gt; recently after someone reported a bug in the package. Since the last post on this package on 2013-06-21, there&amp;rsquo;s a bunch of changes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Removed the &lt;code&gt;sofa_&lt;/code&gt; prefix from all functions as it wasn&amp;rsquo;t really necessary.&lt;/li&gt;
&lt;li&gt;Replaced &lt;code&gt;rjson&lt;/code&gt;/&lt;code&gt;RJSONIO&lt;/code&gt; with &lt;code&gt;jsonlite&lt;/code&gt; for JSON I/O.&lt;/li&gt;
&lt;li&gt;New functions:
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;revisions()&lt;/code&gt; - to get the revision numbers for a document.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;uuids()&lt;/code&gt; - get any number of UUIDs - e.g., if you want to set document IDs with UUIDs&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Most functions that deal with documents are prefixed with &lt;code&gt;doc_&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Functions that deal with databases are prefixed with &lt;code&gt;db_&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Simplified all code, reducing duplication&lt;/li&gt;
&lt;li&gt;All functions take &lt;code&gt;cushion&lt;/code&gt; as the first parameter, for consistency sake.&lt;/li&gt;
&lt;li&gt;Changed &lt;code&gt;cushion()&lt;/code&gt; function so that you can only register one cushion with each function call,
and the function takes parameters for each element now, &lt;code&gt;name&lt;/code&gt; (name of the cushion, whatever you want), &lt;code&gt;user&lt;/code&gt; (user name, if applicable), &lt;code&gt;pwd&lt;/code&gt; (password, if applicable), &lt;code&gt;type&lt;/code&gt; (one of localhost, cloudant, or iriscouch), and &lt;code&gt;port&lt;/code&gt; (if applicable).&lt;/li&gt;
&lt;li&gt;Changed package license from &lt;code&gt;CC0&lt;/code&gt; to &lt;code&gt;MIT&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There&amp;rsquo;s still more to do, but I&amp;rsquo;m pretty happy with the recent changes, and I hope at least some find the package useful. Also, would love people to try it out as all bugs are shallow and all that&amp;hellip;&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>I&rsquo;ve reworked <code>sofa</code> recently after someone reported a bug in the package. Since the last post on this package on 2013-06-21, there&rsquo;s a bunch of changes:</p>
<ul>
<li>Removed the <code>sofa_</code> prefix from all functions as it wasn&rsquo;t really necessary.</li>
<li>Replaced <code>rjson</code>/<code>RJSONIO</code> with <code>jsonlite</code> for JSON I/O.</li>
<li>New functions:
<ul>
<li><code>revisions()</code> - to get the revision numbers for a document.</li>
<li><code>uuids()</code> - get any number of UUIDs - e.g., if you want to set document IDs with UUIDs</li>
</ul>
</li>
<li>Most functions that deal with documents are prefixed with <code>doc_</code></li>
<li>Functions that deal with databases are prefixed with <code>db_</code></li>
<li>Simplified all code, reducing duplication</li>
<li>All functions take <code>cushion</code> as the first parameter, for consistency sake.</li>
<li>Changed <code>cushion()</code> function so that you can only register one cushion with each function call,
and the function takes parameters for each element now, <code>name</code> (name of the cushion, whatever you want), <code>user</code> (user name, if applicable), <code>pwd</code> (password, if applicable), <code>type</code> (one of localhost, cloudant, or iriscouch), and <code>port</code> (if applicable).</li>
<li>Changed package license from <code>CC0</code> to <code>MIT</code></li>
</ul>
<p>There&rsquo;s still more to do, but I&rsquo;m pretty happy with the recent changes, and I hope at least some find the package useful. Also, would love people to try it out as all bugs are shallow and all that&hellip;</p>
<p>The following are a few examples of package use.</p>
<h2 id="install-couchdb">Install CouchDB</h2>
<p>Instructions <a href="https://wiki.apache.org/couchdb/Installation">here</a></p>
<h2 id="start-couchdb">Start CouchDB</h2>
<p>In your terminal</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>couchdb
</span></span></code></pre></div><p>You can interact with your CouchDB databases as well in your browser. Navigate to <a href="http://localhost:5984/_utils">http://localhost:5984/_utils</a></p>
<h2 id="install-sofa">Install sofa</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;devtools&#34;</span>)
</span></span><span style="display:flex;"><span>devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;sckott/sofa&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;sofa&#39;</span>)
</span></span></code></pre></div><h2 id="authenticate---cushions">Authenticate - Cushions</h2>
<p>As an example, here&rsquo;s how I set up details for connecting to my Cloudant couch:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">cushion</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cloudant&#39;</span>, user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;user name&gt;&#39;</span>, pwd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;password&gt;&#39;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cloudant&#34;</span>)
</span></span></code></pre></div><p>By default there is a built-in <code>cushion</code> for localhost so you don&rsquo;t have to do that, unless you want to change those details, e.g., the port number. Right now cushions aren&rsquo;t preserved across R sessions, but working on that.</p>
<p>For example, I&rsquo;ll lay down a cushion for Cloudant, then I can call <code>cushions()</code> to see my cushions:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">cushion</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cloudant&#39;</span>, user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;user name&gt;&#39;</span>, pwd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;pwd&gt;&#39;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cloudant&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">cushions</span>()
</span></span></code></pre></div><p>By default, if you don&rsquo;t provide a cushion name, you are using localhost.</p>
<h2 id="ping-the-server">Ping the server</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">ping</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $couchdb</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Welcome&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $uuid</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;2c10f0c6d9bd17205b692ae93cd4cf1d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $version</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1.6.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $vendor</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $vendor$version</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1.6.0-1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $vendor$name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Homebrew&#34;</span>
</span></span></code></pre></div><p>Nice, it&rsquo;s working.</p>
<h2 id="create-a-new-database-and-list-available-databases">Create a new database, and list available databases</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">db_create</span>(dbname<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sofadb&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $ok</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] TRUE</span>
</span></span></code></pre></div><p>see if its there now</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">db_list</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [1] &#34;_replicator&#34; &#34;_users&#34;      &#34;alm_couchdb&#34; &#34;cachecall&#34;   &#34;hello_earth&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [6] &#34;leothelion&#34;  &#34;mran&#34;        &#34;mydb&#34;        &#34;newdbs&#34;      &#34;sofadb&#34;</span>
</span></span></code></pre></div><h2 id="create-documents">Create documents</h2>
<p>Create a document WITH a name (uses PUT)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>doc1 <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{&#34;name&#34;:&#34;sofa&#34;,&#34;beer&#34;:&#34;IPA&#34;}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doc_create</span>(dbname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sofadb&#34;</span>, doc<span style="color:#f92672">=</span>doc1, docid<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;a_beer&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $ok</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] TRUE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;a_beer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-a48c98c945bcc05d482bc6f938c89882&#34;</span>
</span></span></code></pre></div><p>Create a document WITHOUT a name (uses POST)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>doc2 <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{&#34;name&#34;:&#34;sofa&#34;,&#34;icecream&#34;:&#34;rocky road&#34;}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doc_create</span>(dbname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sofadb&#34;</span>, doc<span style="color:#f92672">=</span>doc2)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $ok</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] TRUE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;c5c5c332c25cf62cc584647a81006f6d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-fd0da7fcb8d3afbfc5757d065c92362c&#34;</span>
</span></span></code></pre></div><h2 id="list-documents">List documents</h2>
<p>List them</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">alldocs</span>(dbname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sofadb&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                 id                              key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1                           a_beer                           a_beer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 c5c5c332c25cf62cc584647a81006f6d c5c5c332c25cf62cc584647a81006f6d</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;                                  rev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 1 1-a48c98c945bcc05d482bc6f938c89882</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; 2 1-fd0da7fcb8d3afbfc5757d065c92362c</span>
</span></span></code></pre></div><p>Optionally include the documents, returned as a list by default as it would be hard to parse an endless number of document formats.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">alldocs</span>(dbname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sofadb&#34;</span>, include_docs <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $total_rows</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $offset</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;a_beer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;a_beer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$value</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$value$rev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-a48c98c945bcc05d482bc6f938c89882&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$doc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$doc$`_id`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;a_beer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$doc$`_rev`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-a48c98c945bcc05d482bc6f938c89882&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$doc$name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;sofa&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[1]]$doc$beer</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;IPA&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;c5c5c332c25cf62cc584647a81006f6d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;c5c5c332c25cf62cc584647a81006f6d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$value</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$value$rev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-fd0da7fcb8d3afbfc5757d065c92362c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$doc</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$doc$`_id`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;c5c5c332c25cf62cc584647a81006f6d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$doc$`_rev`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-fd0da7fcb8d3afbfc5757d065c92362c&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$doc$name</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;sofa&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rows[[2]]$doc$icecream</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;rocky road&#34;</span>
</span></span></code></pre></div><h2 id="update-a-document">Update a document</h2>
<p>Change <em>IPA</em> (india pale ale) to <em>IPL</em> (india pale lager). We need to get revisions first as we need to include revision number when we update a document.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>(revs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">revisions</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sofadb&#34;</span>, docid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a_beer&#34;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;1-a48c98c945bcc05d482bc6f938c89882&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>newdoc <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#39;{&#34;name&#34;:&#34;sofa&#34;,&#34;beer&#34;:&#34;IPL&#34;}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doc_update</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sofadb&#34;</span>, doc <span style="color:#f92672">=</span> newdoc, docid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a_beer&#34;</span>, rev <span style="color:#f92672">=</span> revs[1])
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $ok</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] TRUE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $id</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;a_beer&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $rev</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;2-f2390eb18b8f9a870c915c6712a7f65e&#34;</span>
</span></span></code></pre></div><p>Should be two revisions now</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">revisions</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sofadb&#34;</span>, docid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a_beer&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;2-f2390eb18b8f9a870c915c6712a7f65e&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [2] &#34;1-a48c98c945bcc05d482bc6f938c89882&#34;</span>
</span></span></code></pre></div><h2 id="get-headers-for-a-document">Get headers for a document</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">doc_head</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sofadb&#34;</span>, docid <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a_beer&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]$status</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] 200</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]$version</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;HTTP/1.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [[1]]$headers</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $server</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;CouchDB/1.6.0 (Erlang OTP/17)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $etag</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;\&#34;2-f2390eb18b8f9a870c915c6712a7f65e\&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $date</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;Tue, 18 Nov 2014 21:19:16 GMT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $`content-type`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;application/json&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $`content-length`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;88&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; $`cache-control`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;must-revalidate&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; attr(,&#34;class&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;insensitive&#34; &#34;list&#34;</span>
</span></span></code></pre></div><h2 id="json-vs-list">JSON vs. list</h2>
<p>Across all/most functions you can request json or list as output with the <code>as</code> parameter.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">db_list</span>(as <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [1] &#34;_replicator&#34; &#34;_users&#34;      &#34;alm_couchdb&#34; &#34;cachecall&#34;   &#34;hello_earth&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [6] &#34;leothelion&#34;  &#34;mran&#34;        &#34;mydb&#34;        &#34;newdbs&#34;      &#34;sofadb&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">db_list</span>(as <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;json&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; [1] &#34;[\&#34;_replicator\&#34;,\&#34;_users\&#34;,\&#34;alm_couchdb\&#34;,\&#34;cachecall\&#34;,\&#34;hello_earth\&#34;,\&#34;leothelion\&#34;,\&#34;mran\&#34;,\&#34;mydb\&#34;,\&#34;newdbs\&#34;,\&#34;sofadb\&#34;]\n&#34;</span>
</span></span></code></pre></div><h2 id="curl-options">Curl options</h2>
<p>Across all functions you can pass in curl options. We&rsquo;re using <code>httr</code> internally, so you can use <code>httr</code> helper functions to make some curl options easier. Examples:</p>
<p>Verbose output</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;httr&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">db_list</span>(config<span style="color:#f92672">=</span><span style="color:#a6e22e">verbose</span>())
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [1] &#34;_replicator&#34; &#34;_users&#34;      &#34;alm_couchdb&#34; &#34;cachecall&#34;   &#34;hello_earth&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [6] &#34;leothelion&#34;  &#34;mran&#34;        &#34;mydb&#34;        &#34;newdbs&#34;      &#34;sofadb&#34;</span>
</span></span></code></pre></div><p>Progress</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">db_list</span>(config<span style="color:#f92672">=</span><span style="color:#a6e22e">progress</span>())
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>                                                                       
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>                                                                 <span style="color:#f92672">|</span>   <span style="color:#ae81ff">0</span><span style="color:#f92672">%
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">  |                                                                       
</span></span></span><span style="display:flex;"><span><span style="color:#f92672">  |=================================================================| 100%</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [1] &#34;_replicator&#34; &#34;_users&#34;      &#34;alm_couchdb&#34; &#34;cachecall&#34;   &#34;hello_earth&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;  [6] &#34;leothelion&#34;  &#34;mran&#34;        &#34;mydb&#34;        &#34;newdbs&#34;      &#34;sofadb&#34;</span>
</span></span></code></pre></div><p>Set a timeout</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">db_list</span>(config<span style="color:#f92672">=</span><span style="color:#a6e22e">timeout</span>(seconds <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.001</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt; Error in function (type, msg, asError = TRUE)  : </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&gt;    Operation timed out after 3 milliseconds with 0 out of -1 bytes received</span>
</span></span></code></pre></div><h2 id="full-text-search">Full text search</h2>
<p>I&rsquo;m working on an R client for Elaticsearch called <code>elastic</code> - find it at <a href="https://github.com/ropensci/elastic">https://github.com/ropensci/elastic</a></p>
<p>Thinking about where to include functions to allow <code>elastic</code> and <code>sofa</code> to work together&hellip;if you have any thoughts hit up the issues. I&rsquo;ll probably include helper functions for CouchDB search in the <code>elastic</code> package, interfacing with the <a href="https://github.com/elasticsearch/elasticsearch-river-couchdb">CouchDB plugin for Elasticsearch</a>.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Stashing and playing with raw data locally from the web</title>
      <link>http://localhost:1313/2013/06/couch/</link>
      <pubDate>Mon, 17 Jun 2013 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/2013/06/couch/</guid>
      <description>&lt;p&gt;It is getting easier to get data directly into R from the web. Often R packages that retrieve data from the web return useful R data structures to users like a data.frame. This is a good thing of course to make things user friendly.&lt;/p&gt;
&lt;p&gt;However, what if you want to drill down into the data that&amp;rsquo;s returned from a query to a database in R?  What if you want to get that nice data.frame in R, but you think you may want to look at the raw data later? The raw data from web queries are often JSON or XML data. This type of data, especially JSON, can be easily stored in schemaless so-called NoSQL databases, and queried later.&lt;/p&gt;</description>
      <content:encoded><![CDATA[<p>It is getting easier to get data directly into R from the web. Often R packages that retrieve data from the web return useful R data structures to users like a data.frame. This is a good thing of course to make things user friendly.</p>
<p>However, what if you want to drill down into the data that&rsquo;s returned from a query to a database in R?  What if you want to get that nice data.frame in R, but you think you may want to look at the raw data later? The raw data from web queries are often JSON or XML data. This type of data, especially JSON, can be easily stored in schemaless so-called NoSQL databases, and queried later.</p>
<p>A brief aside: What are JSON and XML? This is what JSON looks like (ps if you ever wonder if your JSON is correct, go <a href="http://jsonlint.com/">here</a>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;joe&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;hobby&#34;</span>: <span style="color:#e6db74">&#34;codemonkey&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lives&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;San Jose&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;state&#34;</span>: <span style="color:#e6db74">&#34;CA&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>This is what XML looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;name&gt;</span>joe<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;hobby&gt;</span>codemonkey<span style="color:#f92672">&lt;/hobby&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;lives&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;city&gt;</span>San Jose<span style="color:#f92672">&lt;/city&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;state&gt;</span>CA<span style="color:#f92672">&lt;/state&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/lives&gt;</span>
</span></span></code></pre></div><p>But don&rsquo;t worry if it looks complicated - the project I talk about below, sofa, tries to make the interface to JSON and XML easy. Web APIs almost always return either JSON or XML, so this is the raw data.</p>
<p>So here&rsquo;s the use case I imagine, or workflow:</p>
<ul>
<li>Query a database on the web, and choose to write the raw data to a local database.</li>
<li>Do whatever you want with the output R object - analyze, visualize, etc.</li>
<li>Now you want to go back and search through some of the raw data. But, that query took an hour. Since you wrote it to a local database, you can search the data.</li>
<li>If you hadn&rsquo;t written it locally, you would have to make a new web call.</li>
</ul>
<p>Note that if you are doing calls to web APIs that get small amounts of data you don&rsquo;t need to worry too much as you can easily just do the call again.</p>
<p>I&rsquo;ve started an R package to interact with the NoSQL database <a href="http://couchdb.apache.org/">CouchDB</a>. CouchDB is a schemaless database that speaks JSON, so you can store JSON and get back JSON (don&rsquo;t worry XML, we got you covered - we can just wrap the XML in JSON before putting it in CouchDB). What&rsquo;s especially cool is you can interact with CouchDB via <a href="http://docs.couchdb.org/en/latest/api-basics.html">a RESTful API</a>. CouchDB doesn&rsquo;t have full text search built in (though you can build map-reduce <em>Views</em>, basically preset queries on the database), so I added functions (and docs to help) to interact with the <a href="https://github.com/elasticsearch/elasticsearch-river-couchdb/blob/master/README.md">CouchDB River plugin</a> for <a href="http://www.elasticsearch.org/">Elasticsearch</a>, which provides powerful full text search via an API interface. But nevermind the tech details - all this just means you can search on the full text of your stored data.</p>
<p>There are plenty of databases you can interact with from R, so why CouchDB? For one, it makes a lot of sense to write to a NoSQL database since this blog post is dealing with a use case writing JSON, which isn&rsquo;t a good fit for databases like MySQL, SQLite, PostgreSQL, etc. (<a href="http://wiki.postgresql.org/wiki/What's_new_in_PostgreSQL_9.2#JSON_datatype">though postgres allows you to write JSON</a>). It didn&rsquo;t have to be CouchDB, but at least to me it seems relatively easy to install, you can interact with it via an HTTP API (if you&rsquo;re into that, which I am), and it has a nice web interface (navigate to <a href="http://localhost:5984/_utils/">http://localhost:5984/_utils/</a> after starting <code>couchdb</code>).</p>
<p>Is this for the casual R user? Probably not. But, I imagine there are R users out there that want some more flexibility when it comes to interacting with web data in R. It is nice and tidy to get back an R data.frame from a web call, but having the raw data at your fingertips could be super powerful. I&rsquo;ll describe using an R package to interact with a web database with <code>sofa</code> baked in, and discuss a bit about the functions within <code>sofa</code>.</p>
<h3 id="first-start-couchdb-in-your-terminal">First start CouchDB in your terminal</h3>
<p>You can do this from anywhere in your directory. See <a href="http://couchdb.apache.org/">here</a> for instructions on how to install CouchDB.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>couchdb
</span></span></code></pre></div><h3 id="then-start-elasticsearch-in-your-terminal">Then start elasticsearch in your terminal</h3>
<p>See <a href="https://github.com/sckott/sofa">here</a> for instructions on how to install Elasticsearch and the River CouchDB plugin.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /usr/local/elasticsearch
</span></span><span style="display:flex;"><span>bin/elasticsearch -f
</span></span></code></pre></div><h3 id="install-sofa">Install sofa</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># Uncomment these lines if you don&#39;t have these packages installed</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># install.packages(&#39;devtools&#39;) library(devtools) install_github(&#39;sofa&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#39;schamberlain&#39;) install_github(&#39;alm&#39;, &#39;ropensci&#39;, ref=&#39;couch&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(sofa)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(alm)
</span></span></code></pre></div><h3 id="simultaneously-write-data-to-couchdb-along-with-api-calls-using-the-alm-package-to-get-altmetrics-data-on-plos-papers-ping-to-make-sure-couchdb-is-on">Simultaneously write data to CouchDB along with API calls using the alm package to get altmetrics data on PLoS papers. Ping to make sure CouchDB is on</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sofa_ping</span>()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  couchdb   version 
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Welcome&#34;</span>   <span style="color:#e6db74">&#34;1.2.1&#34;</span> 
</span></span></code></pre></div><h3 id="create-a-new-database">Create a new database</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sofa_createdb</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>  ok 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">TRUE</span> 
</span></span></code></pre></div><h3 id="write-couchdb-database-name-to-options">Write couchdb database name to options</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">options</span>(couch_db_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>)
</span></span></code></pre></div><h3 id="list-the-databases">List the databases</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sofa_listdbs</span>()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span> [1] <span style="color:#e6db74">&#34;_replicator&#34;</span>                <span style="color:#e6db74">&#34;_users&#34;</span>                    
</span></span><span style="display:flex;"><span> [3] <span style="color:#e6db74">&#34;alm_couchdb&#34;</span>                <span style="color:#e6db74">&#34;alm_db&#34;</span>                    
</span></span><span style="display:flex;"><span> [5] <span style="color:#e6db74">&#34;dudedb&#34;</span>                     <span style="color:#e6db74">&#34;example&#34;</span>                   
</span></span><span style="display:flex;"><span> [7] <span style="color:#e6db74">&#34;poop&#34;</span>                       <span style="color:#e6db74">&#34;rplos_db&#34;</span>                  
</span></span><span style="display:flex;"><span> [9] <span style="color:#e6db74">&#34;shit&#34;</span>                       <span style="color:#e6db74">&#34;shitty&#34;</span>                    
</span></span><span style="display:flex;"><span>[11] <span style="color:#e6db74">&#34;shitty2&#34;</span>                    <span style="color:#e6db74">&#34;test_suite_db&#34;</span>             
</span></span><span style="display:flex;"><span>[13] <span style="color:#e6db74">&#34;test_suite_db/with_slashes&#34;</span> <span style="color:#e6db74">&#34;test_suite_reports&#34;</span>        
</span></span><span style="display:flex;"><span>[15] <span style="color:#e6db74">&#34;testr2couch&#34;</span>                <span style="color:#e6db74">&#34;twitter_db&#34;</span>                
</span></span></code></pre></div><h3 id="search-for-altmetrics-normally-wo-writing-to-a-database">Search for altmetrics normally, w/o writing to a database</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">head</span>(<span style="color:#a6e22e">alm</span>(doi <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.1371/journal.pone.0029797&#34;</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>          .id pdf html shares groups comments likes citations total
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>   bloglines  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>   citeulike  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>      <span style="color:#ae81ff">1</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>        <span style="color:#66d9ef">NA</span>     <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    connotea  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>    crossref  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">6</span>     <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>      nature  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">4</span>     <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> postgenomic  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h3 id="search-for-altmetrics-normally-while-writing-to-a-database">Search for altmetrics normally, while writing to a database</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">head</span>(<span style="color:#a6e22e">alm</span>(doi <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.1371/journal.pone.0029797&#34;</span>, write2couch <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>          .id pdf html shares groups comments likes citations total
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>   bloglines  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>   citeulike  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>      <span style="color:#ae81ff">1</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>        <span style="color:#66d9ef">NA</span>     <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    connotea  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>    crossref  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">6</span>     <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>      nature  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">4</span>     <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> postgenomic  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h3 id="make-lots-of-calls-and-write-them-simultaneously">Make lots of calls, and write them simultaneously</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># install_github(&#39;rplos&#39;, &#39;ropensci&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(rplos)
</span></span><span style="display:flex;"><span>dois <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">searchplos</span>(terms <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;evolution&#34;</span>, fields <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;id&#34;</span>, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">alm</span>(doi <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(dois[, <span style="color:#ae81ff">1</span>]), write2couch <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">lapply</span>(out[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>], head)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#f92672">$</span>`01`
</span></span><span style="display:flex;"><span>          .id pdf html shares groups comments likes citations total
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>   bloglines  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>   citeulike  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>      <span style="color:#ae81ff">0</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>        <span style="color:#66d9ef">NA</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    connotea  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>    crossref  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>      nature  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> postgenomic  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span>`02`
</span></span><span style="display:flex;"><span>          .id pdf html shares groups comments likes citations total
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>   bloglines  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>   citeulike  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>      <span style="color:#ae81ff">1</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>        <span style="color:#66d9ef">NA</span>     <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>    connotea  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span>    crossref  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">2</span>     <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>      nature  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> postgenomic  <span style="color:#66d9ef">NA</span>   <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>     <span style="color:#66d9ef">NA</span>       <span style="color:#66d9ef">NA</span>    <span style="color:#66d9ef">NA</span>         <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h3 id="writing-data-to-couchdb-does-take-a-bit-longer">Writing data to CouchDB does take a bit longer</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">system.time</span>(<span style="color:#a6e22e">alm</span>(doi <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(dois[, <span style="color:#ae81ff">1</span>])[1<span style="color:#f92672">:</span><span style="color:#ae81ff">60</span>], write2couch <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>   user  system elapsed 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">1.739</span>   <span style="color:#ae81ff">0.016</span>   <span style="color:#ae81ff">4.554</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">system.time</span>(<span style="color:#a6e22e">alm</span>(doi <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(dois[, <span style="color:#ae81ff">1</span>])[1<span style="color:#f92672">:</span><span style="color:#ae81ff">60</span>], write2couch <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>   user  system elapsed 
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">3.579</span>   <span style="color:#ae81ff">0.062</span>   <span style="color:#ae81ff">6.460</span> 
</span></span></code></pre></div><h3 id="search-using-elasticsearch">Search using elasticsearch</h3>
<h4 id="tell-elasticsearch-to-start-indexing-your-database">tell elasticsearch to start indexing your database</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">elastic_start</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#f92672">$</span>ok
</span></span><span style="display:flex;"><span>[1] <span style="color:#66d9ef">TRUE</span>
</span></span></code></pre></div><h4 id="search-your-database">Search your database</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">elastic_search</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>, q <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;twitter&#34;</span>, parse_ <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</span></span><span style="display:flex;"><span>out<span style="color:#f92672">$</span>hits<span style="color:#f92672">$</span>total
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>[1] <span style="color:#ae81ff">679</span>
</span></span></code></pre></div><h3 id="using-views">Using views</h3>
<h4 id="write-a-view---here-letting-key-be-the-default-of-null">Write a view - here letting key be the default of null</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sofa_view_put</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>, design_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;myview&#34;</span>, value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;doc.baseurl&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#f92672">$</span>ok
</span></span><span style="display:flex;"><span>[1] <span style="color:#66d9ef">TRUE</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span>id
</span></span><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;_design/myview&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span>rev
</span></span><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;1-e7c17cff1b96e4595c3781da53e16ad8&#34;</span>
</span></span></code></pre></div><h4 id="get-info-on-your-new-view">Get info on your new view</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sofa_view_get</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>, design_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;myview&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#f92672">$</span>`_id`
</span></span><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;_design/myview&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span>`_rev`
</span></span><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;1-e7c17cff1b96e4595c3781da53e16ad8&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span>views
</span></span><span style="display:flex;"><span><span style="color:#f92672">$</span>views<span style="color:#f92672">$</span>foo
</span></span><span style="display:flex;"><span>                                    map 
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;function(doc){emit(null,doc.baseurl)}&#34;</span> 
</span></span></code></pre></div><h4 id="get-data-using-a-view">Get data using a view</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>out <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sofa_view_search</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>, design_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;myview&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">length</span>(out<span style="color:#f92672">$</span>rows)  <span style="color:#75715e"># 160 results</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>[1] <span style="color:#ae81ff">161</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sapply</span>(out<span style="color:#f92672">$</span>rows, <span style="color:#66d9ef">function</span>(x) x<span style="color:#f92672">$</span>value)[1<span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>]  <span style="color:#75715e"># the values, just the API call URLs</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;http://alm.plos.org/api/v3/articles&#34;</span>
</span></span><span style="display:flex;"><span>[2] <span style="color:#e6db74">&#34;http://alm.plos.org/api/v3/articles&#34;</span>
</span></span><span style="display:flex;"><span>[3] <span style="color:#e6db74">&#34;http://alm.plos.org/api/v3/articles&#34;</span>
</span></span><span style="display:flex;"><span>[4] <span style="color:#e6db74">&#34;http://alm.plos.org/api/v3/articles&#34;</span>
</span></span><span style="display:flex;"><span>[5] <span style="color:#e6db74">&#34;http://alm.plos.org/api/v3/articles&#34;</span>
</span></span></code></pre></div><h4 id="delete-the-view">Delete the view</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">sofa_view_del</span>(dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;alm_db&#34;</span>, design_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;myview&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>[1] <span style="color:#e6db74">&#34;&#34;</span>
</span></span></code></pre></div><h2 id="what-now">What now?</h2>
<p>Well, if no one uses this, then probably nothing. Though, if people think this could be useful:</p>
<ul>
<li>It would be cool to make easy hooks into any package making web calls to allow users to write data to CouchDB if they choose to, sort of like the example above with rplos.</li>
<li>Perhaps automate some of the setup for CouchDB for users, making system calls so they don&rsquo;t have to.</li>
<li>Performance: As shown above, simultaneously writing data to CouchDB takes longer than not doing so - removing this time difference will make writing to couch more palatable.</li>
</ul>
<h2 id="what-do-you-think">What do you think?</h2>
<p>What is your reaction to this post?  Do you have a need for this sort of tool?  Do you have similar use cases that could be addressed with <code>sofa</code>?</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
