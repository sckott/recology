<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Conditionality meta-analysis data | Recology</title>
<meta name="keywords" content="R, data">
<meta name="description" content="The paper One paper from my graduate work asked most generally ~ &ldquo;How much does the variation in magnitudes and signs of species interaction outcomes vary?&rdquo;. More specifically, we wanted to know if variation differed among species interaction classes (mutualism, competition, predation), and among various &ldquo;gradients&rdquo; (space, time, etc.). To answer this question, we used a meta-analysis approach (rather than e.g., a field experiment). We published the paper recently.
p.s. I really really wish we would have put it in an open access journal&hellip;">
<meta name="author" content="Scott Chamberlain">
<link rel="canonical" href="http://localhost:1313/2014/10/conditionality-meta-analysis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f4cda22486791d430ef692108ba33a982c3c552eca57e99456bb55aa4bd22568.css" integrity="sha256-9M2iJIZ5HUMO9pIQi6M6mCw8VS7KV&#43;mUVrtVqkvSJWg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/2014/10/conditionality-meta-analysis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Recology (Alt + H)">Recology</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/index.xml" title="RSS">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Conditionality meta-analysis data
    </h1>
    <div class="post-meta"><span title='2014-10-06 00:00:00 +0000 UTC'>October 6, 2014</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Scott Chamberlain

</div>
  </header> 
  <div class="post-content"><h2 id="the-paper">The paper<a hidden class="anchor" aria-hidden="true" href="#the-paper">#</a></h2>
<p>One paper from my graduate work asked most generally ~ &ldquo;How much does the variation in magnitudes and signs of species interaction outcomes vary?&rdquo;. More specifically, we wanted to know if variation differed among species interaction classes (mutualism, competition, predation), and among various &ldquo;gradients&rdquo; (space, time, etc.). To answer this question, we used a meta-analysis approach (rather than e.g., a field experiment). We <a href="https://scottchamberlain.info/publications/">published the paper</a> recently.</p>
<blockquote>
<p>p.s. I really really wish we would have put it in an open access journal&hellip;</p>
</blockquote>
<h2 id="the-data">The data<a hidden class="anchor" aria-hidden="true" href="#the-data">#</a></h2>
<p>Anyway, I&rsquo;m here to talk about the <strong>data</strong>. We didn&rsquo;t get the data up with the paper, but it is <a href="https://figshare.com/articles/Conditionality_data/1097657">up on Figshare</a> now. The files there are the following:</p>
<ul>
<li><code>coniditionality.R</code> - script used to process the data from <code>variables_prelim.csv</code></li>
<li><code>variables_prelim.csv</code> - description of variables in the preliminary data set, matches <code>conditionality_data_prelim.csv</code></li>
<li><code>variables_used.csv</code> - description of variables in the used data set, matches <code>conditionality_data_used.csv</code></li>
<li><code>conditionality_data_prelim.csv</code> - preliminary data, the raw data</li>
<li><code>conditionality_data_used.csv</code> - the data used for our paper</li>
<li><code>README.md</code> - the readme</li>
<li><code>paper_selection.csv</code> - the list of papers we went through, with remarks about paper selection</li>
</ul>
<p>Please do play with the data, publish some papers, etc, etc. It took 6 of us about 4 years to collect this data; we skimmed through ~11,000 papers on the first pass (aka. skimming through abstracts in Google Scholar and Web of Science), then decided on nearly 500 papers to get data from, and narrowed down to 247 papers for the publication mentioned above. Now, there was no funding for this, so it was sort of done in between other projects, but still, it was simply <strong>A LOT</strong> of tables to digitize, and graphs to extract data points from. <strong>Anyway</strong>, hopefully you will find this data useful :p</p>
<h2 id="eml">EML<a hidden class="anchor" aria-hidden="true" href="#eml">#</a></h2>
<p>I think this dataset would be a great introduction to the potential power of EML (<a href="https://knb.ecoinformatics.org/#external//emlparser/docs/index.html">Ecological Metadata Langauge</a>). At <a href="http://ropensci.org/">rOpenSci</a>, one of our team <a href="https://www.carlboettiger.info/">Carl Boettiger</a>, along with Claas-Thido Pfaff, Duncan Temple Lang, Karthik Ram, and Matt Jones, have created an R client for EML, to parse EML files and to create and publish them.</p>
<h2 id="what-is-emlwhy-eml">What is EML?/Why EML?<a hidden class="anchor" aria-hidden="true" href="#what-is-emlwhy-eml">#</a></h2>
<p>A demonstration is in order&hellip;</p>
<h2 id="example-using-eml-with-this-dataset">Example using EML with this dataset<a hidden class="anchor" aria-hidden="true" href="#example-using-eml-with-this-dataset">#</a></h2>
<h3 id="install-eml">Install EML<a hidden class="anchor" aria-hidden="true" href="#install-eml">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#34;devtools&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;RHTMLForms&#34;</span>, repos <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://www.omegahat.org/R/&#34;</span>, type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;source&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;ropensci/EML&#34;</span>, build<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>, dependencies<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;DEPENDS&#34;</span>, <span style="color:#e6db74">&#34;IMPORTS&#34;</span>))
</span></span></code></pre></div><p>Load <code>EML</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;EML&#39;</span>)
</span></span></code></pre></div><h3 id="prepare-metadata">Prepare metadata<a hidden class="anchor" aria-hidden="true" href="#prepare-metadata">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># dataset</span>
</span></span><span style="display:flex;"><span>prelim_dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.csv</span>(<span style="color:#e6db74">&#34;conditionality_data_prelim.csv&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># variable descriptions for each column</span>
</span></span><span style="display:flex;"><span>prelim_vars <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read.csv</span>(<span style="color:#e6db74">&#34;variables_prelim.csv&#34;</span>, stringsAsFactors <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</span></span></code></pre></div><p>Get column definitions in a vector</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>col_defs <span style="color:#f92672">&lt;-</span> prelim_vars<span style="color:#f92672">$</span>description
</span></span></code></pre></div><p>Create unit definitions for each column</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>unit_defs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>    bounds <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">Inf</span>)),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>    bounds <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">Inf</span>)),
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;independent replicates&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">c</span>(unit <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;number&#34;</span>,
</span></span><span style="display:flex;"><span>    bounds <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">Inf</span>)),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">...</span> <span style="color:#f92672">&lt;</span>CUTOFF<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><h3 id="write-an-eml-file">Write an EML file<a hidden class="anchor" aria-hidden="true" href="#write-an-eml-file">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">eml_write</span>(prelim_dat,
</span></span><span style="display:flex;"><span>          unit.defs <span style="color:#f92672">=</span> unit_defs,
</span></span><span style="display:flex;"><span>          col.defs <span style="color:#f92672">=</span> col_defs,
</span></span><span style="display:flex;"><span>          creator <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Scott Chamberlain&#34;</span>,
</span></span><span style="display:flex;"><span>          contact <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;myrmecocystus@gmail.com&#34;</span>,
</span></span><span style="display:flex;"><span>          file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;conditionality_data_prelim_eml.xml&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] &#34;conditionality_data_prelim_eml.xml&#34;
</code></pre><h3 id="validate-the-eml-file">Validate the EML file<a hidden class="anchor" aria-hidden="true" href="#validate-the-eml-file">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">eml_validate</span>(<span style="color:#e6db74">&#34;conditionality_data_prelim_eml.xml&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## EML specific tests XML specific tests 
##               TRUE               TRUE
</code></pre><h3 id="read-data-and-metadata">Read data and metadata<a hidden class="anchor" aria-hidden="true" href="#read-data-and-metadata">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>gg <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">eml_read</span>(<span style="color:#e6db74">&#34;conditionality_data_prelim_eml.xml&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">eml_get</span>(gg, <span style="color:#e6db74">&#34;contact&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## [1] &#34;myrmecocystus@gmail.com&#34;
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">eml_get</span>(gg, <span style="color:#e6db74">&#34;citation_info&#34;</span>)
</span></span></code></pre></div><pre tabindex="0"><code>## Chamberlain S (2014-10-06). _metadata_.
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">eml_get</span>(gg, <span style="color:#e6db74">&#34;data.frame&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">head</span>(dat[,<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)])
</span></span></code></pre></div><pre tabindex="0"><code>##   order i indrep avg author_last  finit_1 finit_2 finit_abv co_author
## 1     1 1      a   1      Devall margaret       s        ms     Thein
## 2     2 1      a   2      Devall margaret       s        ms     Thein
## 3     3 1      a   3      Devall margaret       s        ms     Thein
## 4     4 1      a   4      Devall margaret       s        ms     Thein
## 5     5 1      a   5      Devall margaret       s        ms     Thein
## 6     6 1      a   6      Devall margaret       s        ms     Thein
##   sinit_1
## 1 leonard
## 2 leonard
## 3 leonard
## 4 leonard
## 5 leonard
## 6 leonard
</code></pre><h3 id="publish">Publish<a hidden class="anchor" aria-hidden="true" href="#publish">#</a></h3>
<p>We can also use the <code>EML</code> package to publish the data, here to <a href="http://figshare.com">Figshare</a>.</p>
<p>First, install <code>rfigshare</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;rfigshare&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;rfigshare&#39;</span>)
</span></span></code></pre></div><p>Then publish using <code>eml_publish()</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>figid <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">eml_publish</span>(
</span></span><span style="display:flex;"><span>            file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;conditionality_data_prelim_eml.xml&#34;</span>,
</span></span><span style="display:flex;"><span>            description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;EML file for Chamberlain, S.A., J.A. Rudgers, and J.L. Bronstein. 2014. How context-dependent are species interactions. Ecology Letters&#34;</span>,
</span></span><span style="display:flex;"><span>            categories <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ecology&#34;</span>,
</span></span><span style="display:flex;"><span>            tags <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;EML&#34;</span>,
</span></span><span style="display:flex;"><span>            destination <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;figshare&#34;</span>,
</span></span><span style="display:flex;"><span>            visibility <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;public&#34;</span>,
</span></span><span style="display:flex;"><span>            title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;condionality data, EML&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fs_make_public</span>(figid)
</span></span></code></pre></div><p><img loading="lazy" src="/2014-10-06-conditionality-meta-analysis/figshare_conditional.png" alt=""  />
</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/r/">R</a></li>
      <li><a href="http://localhost:1313/tags/data/">Data</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Recology</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
