<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Software rules and Quarto | Recology</title>
<meta name="keywords" content="quarto">
<meta name="description" content="At work I&rsquo;ve been using Quarto quite a bit for website and books for work projects.
One of the projects I&rsquo;ve been working on lately that uses Quarto is the WILDS Contributor Guide (WILDS = Workflows Integrating Large Data and Software). This guide (a Quarto book) is mostly a guide for our own immediate team members, but aims to a) be a guide for any contributors to our open source software work, and b) demonstrate good open source software practices for the greater Fred Hutch community where we work.">
<meta name="author" content="Scott Chamberlain">
<link rel="canonical" href="http://localhost:1313/2024/09/quarto-rules/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f4cda22486791d430ef692108ba33a982c3c552eca57e99456bb55aa4bd22568.css" integrity="sha256-9M2iJIZ5HUMO9pIQi6M6mCw8VS7KV&#43;mUVrtVqkvSJWg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/2024/09/quarto-rules/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Recology (Alt + H)">Recology</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/index.xml" title="RSS">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Software rules and Quarto
    </h1>
    <div class="post-meta"><span title='2024-09-26 00:00:00 +0000 UTC'>September 26, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Scott Chamberlain

</div>
  </header> 
  <div class="post-content"><p>At <a href="https://www.fredhutch.org/en.html">work</a> I&rsquo;ve been using <a href="https://quarto.org/docs/guide/">Quarto</a> quite a bit for website and books for work projects.</p>
<p>One of the projects I&rsquo;ve been working on lately that uses Quarto is the <a href="http://getwilds.org/guide/">WILDS Contributor Guide</a> (WILDS = <em>Workflows Integrating Large Data and Software</em>). This guide (a Quarto book) is mostly a guide for our own immediate team members, but aims to a) be a guide for any contributors to our open source software work, and b) demonstrate good open source software practices for the greater <a href="https://www.fredhutch.org/en.html">Fred Hutch</a> community where we work.</p>
<p>Whenever there&rsquo;s a group of people working on the same software, it can help to have some guidelines - or rules - for how software should be built. With any group there&rsquo;s likely to be some aspects that are left up to the individual, whereas other aspects should be enforced rules.</p>
<p>There are many benefits to having everyone follow the same set of rules, including a predictable and consistent software building culture, and trust from the users of the software that the maintainers have reasonable guard rails (assuming those rules are transparent; see note below about <a href="#transparency">Transparency</a> ).</p>
<p>For the rules, how do we:</p>
<ul>
<li>enforce them with the least effort possible? this is not out of laziness for its own sake, but realizing that if it&rsquo;s not easy it may not happen</li>
<li>keep track of any changes in rules (in our case the <a href="http://getwilds.org/guide/">WILDS Guide</a>) so that what we say we do is what we actually do</li>
</ul>
<p>Searching around I haven&rsquo;t found much out there that formalizes this. There&rsquo;s some great transparent and documented stuff out there, e.g. <a href="https://thoughtbot.com/playbook#developing">Thoughtbot&rsquo;s playbook</a> - but they don&rsquo;t describe how they check that their employees do what they say they should do.</p>
<p>What we&rsquo;re doing is the following:</p>
<ul>
<li>In our <a href="http://getwilds.org/guide/">WILDS Guide</a> we have:
<ul>
<li>Easy to find rules for humans &hellip; that are defined with</li>
<li>Machine readable rules for machines</li>
</ul>
</li>
<li>For rule compliance repos will have their on GitHub Actions running various things</li>
<li>For automatable rule compliance across repos we&rsquo;re using GitHub Actions. I&rsquo;ve just started work on this automated compliance at <a href="https://github.com/getwilds/rules">https://github.com/getwilds/rules</a>. You can see <a href="https://github.com/getwilds/rules/actions/runs/10892898375/job/30226762776#step:6:13">an example</a> of one of the rule checks output</li>
<li>For rule compliance that requires human review we&rsquo;ll enfuse into the culture the actions that need to be taken</li>
</ul>
<p>This is very much a work in progress, and could be a fool&rsquo;s errand. Maybe all this rule compliance stuff will make it too hard to get work done. Maybe it will just be too complicated and the work of doing all of this isn&rsquo;t worth it; i.e., rule compliance  isn&rsquo;t the goal, but is just a tool to get our real work done and build trust in the community.</p>
<p>I&rsquo;d love to hear what&rsquo;s working - and what&rsquo;s not - for other folks. Holla at me on <a href="https://fosstodon.org/@sckottie">Mastodon</a> or <a href="https://bsky.app/profile/sckott.bsky.social">Bluesky</a>.</p>
<hr>
<p>If you&rsquo;re interested in the details &hellip;</p>
<h3 id="machine-readable">Machine readable<a hidden class="anchor" aria-hidden="true" href="#machine-readable">#</a></h3>
<p>The machine readable rules are defined using Quarto&rsquo;s <code>_variables.yml</code> file, ours is at <a href="https://github.com/getwilds/guide/blob/main/_variables.yml">https://github.com/getwilds/guide/blob/main/_variables.yml</a>. A snippet of it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#ae81ff">1.2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">merge-main-release</span>: &gt;<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Every merge from `dev` into `main` should constitute a release, which
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    should generate a tagged version of the software and an increment to the
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    version number</span>    
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">release-tags</span>: <span style="color:#ae81ff">Code releases that correspond to specific git tags.</span>
</span></span></code></pre></div><p>The great thing about this approach is that it&rsquo;s a single file and it&rsquo;s easy for a machine to read. So a machine can watch for any changes in this file to trigger any todo&rsquo;s in other places.</p>
<p>That&rsquo;s not how I started though. My first thought was child documents, thinking that it would make it clear to have a separate &ldquo;rules&rdquo; dir in the repo with a separate child callout in a qmd file for every rule. This looked like</p>
<pre tabindex="0"><code>::: {.callout-note icon=false}

## {{ iconify carbon rule-draft }} Rule

At least two but no more than three designated project leads (specified in the [CODEOWNERS file][codeowners]).
:::
</code></pre><h3 id="appearance-of-rules">Appearance of rules<a hidden class="anchor" aria-hidden="true" href="#appearance-of-rules">#</a></h3>
<p>I ended up using just simple Bootstrap badges with icons at the beginning of a rule to indicate that it&rsquo;s a rule. I disregarded this at first as I thought it wasn&rsquo;t grabbing the readers attention enough. But this allowed flexibility to have a rule be embedded within a paragraph or be on its own line in a bullet or not.</p>
<p><img loading="lazy" src="/quarto-rules/badge.png" alt="screenshot of callouts on WILDS guide"  />
</p>
<p>However, my first gut feeling was to use alerts, or what Quarto calls &ldquo;callouts&rdquo;.</p>
<p><img loading="lazy" src="/quarto-rules/guide-callout.png" alt="screenshot of callouts on WILDS guide"  />
</p>
<p>The landing page of our WILDS guide has <a href="http://getwilds.org/guide/#rules">a section describing the rules</a>.</p>
<h3 id="transparency">Transparency<a hidden class="anchor" aria-hidden="true" href="#transparency">#</a></h3>
<p>The building trust part of my motivation above I think means that rules need to be transparent to users. If this is done well I think it makes our lives easier as well.</p>
<p>What I mean in practice is the following. So I discussed how we&rsquo;re using badges to indicate a rule in our guide above. One way to approach this is if you click on one of the badges it brings you to another page or github repo that has more details, including more words about how it&rsquo;s implemented, and link to a automated GH Action that does the check or to docs about how a human review is done. This doesn&rsquo;t exist yet.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/quarto/">Quarto</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Recology</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
