<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>how many parameters? | Recology</title>
<meta name="keywords" content="R, programming">
<meta name="description" content="Functions can have no parameters, or have a lot of parameters, or somewhere
in between. How many parameters is too many? Does it even matter how many
parameters there are in a function?
There&rsquo;s AFAIK no &ldquo;correct&rdquo; answer to this question. And surely the &ldquo;best
practice&rdquo; varies among programming languages. What do folks say about
this and what should we be doing in R?
From other languages
Many of the blog posts and SO posts on this topic cite the book
Clean Code by &ldquo;Uncle Bob&rdquo;. I&rsquo;ve not read the book, but
it sounds worth a read.">
<meta name="author" content="Scott Chamberlain">
<link rel="canonical" href="http://localhost:1313/2020/02/how-many-parameters/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f4cda22486791d430ef692108ba33a982c3c552eca57e99456bb55aa4bd22568.css" integrity="sha256-9M2iJIZ5HUMO9pIQi6M6mCw8VS7KV&#43;mUVrtVqkvSJWg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/2020/02/how-many-parameters/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Recology (Alt + H)">Recology</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/index.xml" title="RSS">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      how many parameters?
    </h1>
    <div class="post-meta"><span title='2020-02-10 00:00:00 +0000 UTC'>February 10, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Scott Chamberlain

</div>
  </header> 
  <div class="post-content"><p>Functions can have no parameters, or have a lot of parameters, or somewhere
in between. How many parameters is too many? Does it even matter how many
parameters there are in a function?</p>
<p>There&rsquo;s AFAIK no &ldquo;correct&rdquo; answer to this question. And surely the &ldquo;best
practice&rdquo; varies among programming languages. What do folks say about
this and what should we be doing in R?</p>
<h2 id="from-other-languages">From other languages<a hidden class="anchor" aria-hidden="true" href="#from-other-languages">#</a></h2>
<p>Many of the blog posts and SO posts on this topic cite the book
<a href="https://www.goodreads.com/book/show/3735293-clean-code">Clean Code</a> by &ldquo;Uncle Bob&rdquo;. I&rsquo;ve not read the book, but
it sounds worth a read.</p>
<p><a href="https://hackernoon.com/object-oriented-tricks-3-death-by-arguments-d070ac86d996">Some of the arguments go like</a>: <em>too many arguments can</em> &hellip;</p>
<ul>
<li>makes it easier to pass arguments in the wrong order</li>
<li>reduce code readability</li>
<li>make it harder to test a function; it’s difficult/time consuming to
test all various combinations of arguments work together</li>
</ul>
<p>An <a href="https://www.exakat.io/how-many-parameters-is-too-many/">analysis was done</a> in 2018 of php open source projects, and they
found that the most common number of parameters was 5; functions with 10
parameters or more were found in &lt;20% of projects.</p>
<p>On the other side, <a href="https://stackoverflow.com/a/175087/1091766">some</a> argue that
you shouldn&rsquo;t worry so much about the correct
number of parameters, but rather make sure that all the parameters make sense,
and are documented and tested.</p>
<p>To the extreme, a number of people <a href="https://stackoverflow.com/a/175035/1091766">quote the Clean Code book</a>:</p>
<blockquote>
<p>The ideal number of arguments for a function is zero</p>
</blockquote>
<p>Some general threads on this topic:</p>
<ul>
<li><a href="https://softwareengineering.stackexchange.com/questions/145055/are-there-guidelines-on-how-many-parameters-a-function-should-accept">Software engineering Stackexchange</a></li>
<li><a href="https://stackoverflow.com/questions/174968/how-many-parameters-are-too-many">Stackoverflow</a></li>
</ul>
<h2 id="data">Data<a hidden class="anchor" aria-hidden="true" href="#data">#</a></h2>
<p>Data for this post, created below, is in the github repo <a href="https://github.com/sckott/howmanyparams">sckott/howmanyparams</a>.</p>
<h2 id="what-about-r">What about R?<a hidden class="anchor" aria-hidden="true" href="#what-about-r">#</a></h2>
<p>What do the data show in the R language? Just like the blog post on php above,
let&rsquo;s have a look at a lot of R packages to get a general data informed
consensus on how many parameters are used per function.</p>
<p>It&rsquo;s incredibly likely that there is a better way to do what I&rsquo;ve done
below; but this is my hacky way of getting to the data.</p>
<p>What I&rsquo;ve done in words:</p>
<ul>
<li>Get a list of all available package names on CRAN</li>
<li>Install about half of them (didn&rsquo;t do all cause it takes time and
I don&rsquo;t think I need all 15K packages to get a good answer)</li>
<li>List the exported functions in each package</li>
<li>Count the arguments (parameters) per function in each package</li>
<li>Visualize the results</li>
</ul>
<p>I ended up using 82489 functions across 4777 packages</p>
<p>Load packages</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(plyr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(dplyr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(tibble)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span></code></pre></div><p>Use a different path from my actual R library location to not pollute
my current setup, and put binaries into a temporary directory
so they are cleaned up on exiting R.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>path <span style="color:#f92672">&lt;-</span> <span style="color:#e6db74">&#34;/some/path&#34;</span>
</span></span><span style="display:flex;"><span>binaries <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">file.path</span>(<span style="color:#a6e22e">tempdir</span>(), <span style="color:#e6db74">&#34;binaries&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dir.create</span>(path)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">dir.create</span>(binaries)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.libPaths</span>(path)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">.libPaths</span>() <span style="color:#75715e"># check that the path was set</span>
</span></span></code></pre></div><p>Function <code>do_one()</code> to run on each package:</p>
<ul>
<li>try to load the package</li>
<li>if not found install it</li>
<li>get a vector of the exported functions in the package</li>
<li>count how many arguments each function has, make a data.frame</li>
<li>unload the package namespace</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>do_one <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(pkg) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(pkg))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">install.packages</span>(pkg, quiet<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>, verbose<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>, destdir <span style="color:#f92672">=</span> binaries)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">on.exit</span>(<span style="color:#a6e22e">unloadNamespace</span>(pkg))
</span></span><span style="display:flex;"><span>  funs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(pkg, <span style="color:#e6db74">&#34;::&#34;</span>, <span style="color:#a6e22e">getNamespaceExports</span>(pkg))
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">enframe</span>(<span style="color:#a6e22e">vapply</span>(funs, <span style="color:#66d9ef">function</span>(w) {
</span></span><span style="display:flex;"><span>    tt <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tryCatch</span>(<span style="color:#a6e22e">parse</span>(text <span style="color:#f92672">=</span> w), error <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(e) e)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">inherits</span>(tt, <span style="color:#e6db74">&#34;error&#34;</span>)) <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">suppressWarnings</span>(<span style="color:#a6e22e">formals</span>(<span style="color:#a6e22e">eval</span>(tt)))) <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  }, <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">1</span>)))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>do_one_safe <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">failwith</span>(<span style="color:#a6e22e">tibble</span>(), do_one)
</span></span></code></pre></div><p>Get a list of packages. First time running through I used <code>available.packages()</code> which
gets you all available packages. After installing packages though, I used
<code>installed.packages()</code> to get the list of packages I already installed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># pkg_names &lt;- unname(available.packages()[,&#34;Package&#34;])</span>
</span></span><span style="display:flex;"><span>pkg_names <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">unname</span>(<span style="color:#a6e22e">installed.packages</span>()[,<span style="color:#e6db74">&#34;Package&#34;</span>])
</span></span></code></pre></div><p>Run each package through the <code>do_one()</code> function. This had to be stopped and
re-started a few times. This failed for quite a few packages - I wasn&rsquo;t trying to get every single package, just a large set of packages to get an idea of what packages do on average.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>tbls <span style="color:#f92672">&lt;-</span> stats<span style="color:#f92672">::</span><span style="color:#a6e22e">setNames</span>(<span style="color:#a6e22e">lapply</span>(pkg_names, do_one_safe), pkg_names)
</span></span></code></pre></div><p>Combine list of data.frame&rsquo;s into one data.frame</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">bind_rows</span>(tbls, .id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pkg&#34;</span>)
</span></span><span style="display:flex;"><span>readr<span style="color:#f92672">::</span><span style="color:#a6e22e">write_csv</span>(df, <span style="color:#e6db74">&#34;params_per_fxn.csv&#34;</span>)
</span></span></code></pre></div><blockquote>
<p>note: you can get this data at <a href="https://github.com/sckott/howmanyparams#how-many-parameters">sckott/howmanyparams</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df <span style="color:#f92672">&lt;-</span> readr<span style="color:#f92672">::</span><span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;~/params_per_fxn.csv&#34;</span>)
</span></span></code></pre></div><p>Visualize</p>
<p><strong>All functions across all packages</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> value)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_histogram</span>(bins <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_x_continuous</span>(limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">30</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_grey</span>(base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>)
</span></span></code></pre></div><p><img loading="lazy" src="/2020-02-10-how-many-parameters/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5"  />
</p>
<p>The mean number of arguments per function across all packages was 4.4,
and the most common value was 3. The maximum number of arguments was
209, and there were 5306 functions
(or 6.4%) with zero
parameters.</p>
<p><strong>Mean params across functions for each pkg</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>df_means <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">group_by</span>(df, pkg) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">summarise</span>(mean_params <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(value, na.rm<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ungroup</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># arrange(df_means, desc(mean_params))</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(df_means, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> mean_params)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">geom_histogram</span>(bins <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">scale_x_continuous</span>(limits <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">30</span>)) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme_grey</span>(base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>)
</span></span></code></pre></div><p><img loading="lazy" src="/2020-02-10-how-many-parameters/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6"  />
</p>
<p>Taking the mean within each package first pulls the number of arguments to the right some,
with a mean of 5 arguments, and the most common value at 4.</p>
<h2 id="thoughts">Thoughts<a hidden class="anchor" aria-hidden="true" href="#thoughts">#</a></h2>
<p>In terms of getting around the too many arguments thing, there&rsquo;s talk of
using global variables, which seems like generally a bad idea; unless perhaps
they are environment variables that are meant to be set by the user in
non-interactive environments, etc.</p>
<p>Other solutions are to use <code>...</code> in R, or similarly <code>**kwargs</code> or <code>*args</code> in Python (<a href="https://pythontips.com/2013/08/04/args-and-kwargs-in-python-explained/">ref.</a>), or
the newly added <code>...</code> in Ruby (<a href="https://eregon.me/blog/2019/11/10/the-delegation-challenge-of-ruby27.html">ref</a>). With this approach you could have very few parameters
defined in the function, and then internally within the function handle any parameter
filtering, etc. The downside of this in R is that you don&rsquo;t get the automated
checks making sure all function arguments are documented, and there&rsquo;s no documented
arguments that don&rsquo;t exist in the function.</p>
<p>I&rsquo;m not suggesting a solution is needed though; there&rsquo;s probably no right answer, but rather lots of opinions.</p>
<p>Having said that, the average R function does use about 4 arguments, so if you
keep your functions to around 4 arguments you&rsquo;ll be approaching the sort of
consensus of a large number of R developers.</p>
<p>Last, I should admit that some of the functions in my packages have quite a lot
of parameters - which was sort of the motivation for this post - that is, to explore
what most functions do. For example, <code>brranching::phylomatic</code> has 13 parameters,
three functions in the <code>crevents</code> package have 24 parameters &hellip; and I wonder
about these types of functions. Should I refactor? Or is it good enough to make
sure these functions are thoroughly documented and tested?</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/r/">R</a></li>
      <li><a href="http://localhost:1313/tags/programming/">Programming</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Recology</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
